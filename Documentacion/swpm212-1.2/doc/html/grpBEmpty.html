<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>SWPM AT86RF212: Frame Buffer Empty Indicator</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="main.html">AT86RF212 Programming</a>&nbsp;&raquo&nbsp;<a class="el" href="pgSwpmAT86RF212.html">Software Programming Model</a>&nbsp;&raquo&nbsp;<a class="el" href="grpMisc.html">Extended Features</a>
  </div>
</div>
<div class="contents">
<h1><a class="anchor" name="grpBEmpty">Frame Buffer Empty Indicator </a></h1>For time critical applications, it may be desirable to read the frame data as early as possible, e.g. right after the occurrence of the interrupt <a class="el" href="group__apiHalPHY212Const.html#gab5ff5ca963c7556f4f1e0e37f045604">TRX_IRQ_RX_START</a>, as described in the use case <a class="el" href="grpPhyRx.html#secphy_data_indication_sw_ack">PHY_DATA_INDICATION_FAST</a>. In order to avoid a RX underrun interrupt in this situation, the frame buffer empty indication of the radio transceiver can be used.<p>
When using this feature, the <a class="el" href="grpIntroMCU.html#wirePinIrq">TRX_PIN_IRQ</a> is reconfigured to indicate the status of the frame buffer. There are unread data in the frame buffer, if the level of pin <a class="el" href="grpIntroMCU.html#wirePinIrq">TRX_PIN_IRQ</a> is LOW. If the level of pin <a class="el" href="grpIntroMCU.html#wirePinIrq">TRX_PIN_IRQ</a> changes to HIGH, it indicates that there are no more unread data in the frame buffer.<p>
The MCU can now wait until the level of pin <a class="el" href="grpIntroMCU.html#wirePinIrq">TRX_PIN_IRQ</a> changes back to LOW and proceed with reading until either the level changes to HIGH or the number of bytes indicated in the PHR field is read. The latency of the frame buffer empty indicator is <a class="el" href="pgConst.html#t13">t13</a>. After finishing the frame upload with setting /SEL=HIGH, <a class="el" href="grpIntroMCU.html#wirePinIrq">TRX_PIN_IRQ</a> will change automatically its mode back to IRQ functionality and all other pending interrupts, which have occurred meanwhile, will be signalled.<p>
<a class="anchor" name="parm_bl_ctrl"></a> <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>bl_ctrl</em>&nbsp;</td><td>enable {1}/disable {0} the frame buffer empty indicator.</td></tr>
  </table>
</dl>
<dl class="note" compact><dt><b>Note:</b></dt><dd>In case of an internal receive error (e.g. an unlock of the PLL), the pin <a class="el" href="grpIntroMCU.html#wirePinIrq">TRX_PIN_IRQ</a> remains locked at HIGH level. In order to prevent a deadlock, the MCU should start a timeout counter <a class="el" href="pgConst.html#tBEDead">tBEDead</a>, when the frame buffer empty indicator turns HIGH.</dd></dl>
<b>Use Cases:</b><ul>
<li><a class="el" href="grpBEmpty.html#seccfg_buffer_empty_ind">SET_BUFFER_EMPTY_IND</a></li><li><a class="el" href="grpBEmpty.html#secget_buffer_empty_ind">GET_BUFFER_EMPTY_IND</a></li><li><a class="el" href="grpBEmpty.html#secbuffer_empty_ind">USE_BUFFER_EMPTY_IND</a></li></ul>
<p>
<hr>
<h2><a class="anchor" name="seccfg_buffer_empty_ind">
SET_BUFFER_EMPTY_IND</a></h2>
The frame buffer empty indicator is enabled when writing <a class="el" href="grpBEmpty.html#parm_bl_ctrl">bl_ctrl</a>=1 to sub register <a class="el" href="group__apiHalPHY212Sreg.html#gc12b3b668a97a79b1db88721c502804e">SR_RX_BL_CTRL</a>.<p>
<div align="center">
<img src="inline_mscgraph_106.png" alt="inline_mscgraph_106" border="0" usemap="#inline_mscgraph_106.map">
<map name="inline_mscgraph_106.map"><area href="grpIntroStates.html#stTrxConfig" shape="rect" coords="427,26,473,39" alt="">
</map>
</div>
 <dl class="user" compact><dt><b>Code example</b></dt><dd><div class="fragment"><pre class="fragment">    <span class="comment">/* AT86RF212::[CONFIG] */</span>
    <a class="code" href="group__apiHalFuncBasic.html#g4a22a30602ea72effde4450ce80a6480" title="Write a value to a subregister.">trx_bit_write</a>(<a class="code" href="group__apiHalPHY212Sreg.html#gc12b3b668a97a79b1db88721c502804e">SR_RX_BL_CTRL</a>, bl_ctrl);
</pre></div></dd></dl>
<h2><a class="anchor" name="secget_buffer_empty_ind">
GET_BUFFER_EMPTY_IND</a></h2>
The value of <a class="el" href="grpBEmpty.html#parm_bl_ctrl">bl_ctrl</a> is retrieved with the following use case:<p>
<div align="center">
<img src="inline_mscgraph_107.png" alt="inline_mscgraph_107" border="0" usemap="#inline_mscgraph_107.map">
<map name="inline_mscgraph_107.map"><area href="grpIntroStates.html#stTrxActive" shape="rect" coords="427,26,473,39" alt="">
</map>
</div>
 <dl class="user" compact><dt><b>Code example</b></dt><dd><div class="fragment"><pre class="fragment">    <span class="comment">/* AT86RF212::[ACTIVE] */</span>
    bl_ctrl = <a class="code" href="group__apiHalFuncBasic.html#ge7ea3d090b5d26b73a5c62e2e61e0231" title="Read a value from a subregister.">trx_bit_read</a>(<a class="code" href="group__apiHalPHY212Sreg.html#gc12b3b668a97a79b1db88721c502804e">SR_RX_BL_CTRL</a>);
</pre></div></dd></dl>
<h2><a class="anchor" name="secbuffer_empty_ind">
USE_BUFFER_EMPTY_IND</a></h2>
The following use case shows, how a frame is read, using the frame buffer empty indicator. Inside the function <a class="el" href="group__apiHalFuncBasic.html#gee1a17975e51ef9df001ff17be1cf6f5">trx_frame_read_blm()</a> the pin <a class="el" href="grpIntroMCU.html#wirePinIrq">TRX_PIN_IRQ</a> is polled. If it changes the level to HIGH, the function terminates with the current fragment of the frame read. When the level of the pin <a class="el" href="grpIntroMCU.html#wirePinIrq">TRX_PIN_IRQ</a> changes back to LOW, the function <a class="el" href="group__apiHalFuncBasic.html#gee1a17975e51ef9df001ff17be1cf6f5">trx_frame_read_blm()</a> continues reading the next data of the frame.<p>
<div align="center">
<img src="inline_mscgraph_108.png" alt="inline_mscgraph_108" border="0" usemap="#inline_mscgraph_108.map">
<map name="inline_mscgraph_108.map"><area href="grpIntroStates.html#stRxActive" shape="rect" coords="418,26,482,39" alt="">
<area href="grpIntroStates.html#stTrxRXBusy" shape="rect" coords="424,76,476,89" alt="">
</map>
</div>
 <dl class="user" compact><dt><b>Code example</b></dt><dd><div class="fragment"><pre class="fragment">    <span class="comment">/* AT86RF212::[RX_ACTIVE] &amp;&amp; AT86RF212::[RX_BUSY] */</span>
    <span class="comment">/* TRX_IRQ_RX_START occurs here */</span>
    <span class="comment">/* AT86RF212::[PIN_IRQ == LOW] */</span>
    frame = <a class="code" href="group__apiHalFuncBasic.html#gee1a17975e51ef9df001ff17be1cf6f5" title="Read frame in buffer level mode.">trx_frame_read_blm</a>();
    <span class="comment">/* AT86RF212::[PIN_IRQ == HIGH] &amp;&amp; AT86RF212::[PIN_IRQ == LOW] */</span>
    frame = <a class="code" href="group__apiHalFuncBasic.html#gee1a17975e51ef9df001ff17be1cf6f5" title="Read frame in buffer level mode.">trx_frame_read_blm</a>();
    <span class="comment">/* TRX_IRQ_TRX_END occurs here */</span>
</pre></div> </dd></dl>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Aug 17 13:35:02 2009 for SWPM AT86RF212 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
