<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>SWPM AT86RF212: Frame Transmit Procedure (TX)</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="main.html">AT86RF212 Programming</a>&nbsp;&raquo&nbsp;<a class="el" href="pgSwpmAT86RF212.html">Software Programming Model</a>&nbsp;&raquo&nbsp;<a class="el" href="grpBasic.html">Basic Operating Mode</a>
  </div>
</div>
<div class="contents">
<h1><a class="anchor" name="grpPhyTx">Frame Transmit Procedure (TX) </a></h1>For transmission of frames in the Basic Operating Mode, the radio transceiver needs to be in the state <a class="el" href="grpIntroStates.html#stPllOn">PLL_ON</a> (see also section <a class="el" href="grpStateTxOn.html">Transitions to State PLL_ON</a>).<p>
<a class="anchor" name="phyTxStart"></a> <b>Frame transmit start commands: </b><br>
 There are two methods to initiate a frame transmission, either with a rising edge on the pin <a class="el" href="grpIntroMCU.html#wirePinSleepTr">TRX_PIN_SLP_TR</a> (pin start) or by writing <a class="el" href="group__apiHalPHY212Const.html#gd47eb7bbddce76aba1a636d6b2344997">CMD_TX_START</a> to sub register <a class="el" href="group__apiHalPHY212Sreg.html#g8d912618842812f37fc46356eff73c93">SR_TRX_CMD</a> (register start) .<p>
After the frame start command, the radio transceiver sends out the <a class="anchor" name="refSHR"></a> IEEE 802.15.4 synchronization header (SHR), which consists of 4 octets preamble and 1 octet start-of-frame delimitter (SFD). The transmission of the whole SHR takes <a class="el" href="pgConst.html#tSHR">tSHR</a>. After SHR, PHR, and PSDU have been transmitted, the <a class="el" href="group__apiHalPHY212Const.html#ge34c1f5817526945d96c7cda6689f342">TRX_IRQ_TRX_END</a> interrupt indicates the completion of the transmission.<p>
<a class="anchor" name="phyTxTiming"></a> <b> Timing constraints for frame transmission: </b><br>
 If the SPI data rate is higher than the data rate of the air interface, the frame can be downloaded after the <a class="el" href="grpPhyTx.html#phyTxStart">transmit start command</a> has been issued. In this case the following conditions need to be met:<ul>
<li>The PHR must be available in the frame buffer before <code>(<a class="el" href="pgConst.html#tTR10">tTR10</a>+<a class="el" href="pgConst.html#tSHR">tSHR</a>)</code>.</li><li>The last byte of the PSDU must be available in the frame buffer at latest <br>
 <code>T = <a class="el" href="pgConst.html#tSHR">tSHR</a> + <a class="el" href="pgConst.html#toct">toct</a> *(len(PHR) + len(PSDU) - 1)</code>.<br>
</li></ul>
<p>
If one of the above conditions is violated, a <a class="el" href="group__apiHalPHY212Const.html#gdfe439356d965b05adfe5d3a206e249b">TRX_IRQ_TRX_UR</a> interrupt occurs and the frame was incorrectly transmitted (see <a class="el" href="grpIrqUR.html#secphy_event_fifounderrun_tx">PHY_EVENT_TRX_UR_TX</a>).<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>frame</em>&nbsp;</td><td>Before a frame transmission, the PHR field and the PSDU have to be stored in the frame buffer. The PHR field contains the PSDU length information (bit 0:6, bit 7 is reserved) and the PSDU contains the payload. The maximum PSDU length is 127. If the sub register <a class="el" href="group__apiHalPHY212Sreg.html#g53420a51ab0ad2e5b108d5cbbdf6f3b6">SR_TX_AUTO_CRC_ON</a> is set to 1, the last two bytes (FCS bytes) of the PSDU do not need to be downloaded, because the FCS is calculated internally by the radio transceiver (see also <a class="el" href="grpSetAutoCRC.html#secphy_data_request_autocrc">PHY_SET_TX_AUTO_CRC</a>). <a class="anchor" name="phySpiFrameTx"></a> The frame is stored in the frame buffer of the radio transceiver in the following way:</td></tr>
  </table>
</dl>
<pre>
        0   1   2                     L-2 L-1  L
      +--- --- --- --- --- --- ~~~~~~ --- --- ---+
      | P | D | D | D | D | D |      | D |D/F|D/F|
      +--- --- --- --- --- --- ~~~~~~ --- --- ---+
      |                                          |
      |&lt;--- access via "SRAM Write Access" -----&gt;|
      |                                          |
      |&lt;--- access via "Frame Write Access" ----&gt;|</pre><p>
<pre>        P   : PHR field containing the PSDU length information L
        D,F : data byte, F = FCS byte (D and F belong to the PSDU)
  </pre><p>
<b>Use Cases:</b><ul>
<li><a class="el" href="grpPhyTx.html#secphy_data_request_pinstart">PHY_DATA_REQUEST_PINSTART</a></li><li><a class="el" href="grpPhyTx.html#secphy_data_request_regstart">PHY_DATA_REQUEST_REGSTART</a></li></ul>
<p>
<hr>
<h2><a class="anchor" name="secphy_data_request_pinstart">
PHY_DATA_REQUEST_PINSTART</a></h2>
This sequence describes a frame transmission, which is initiated by a rising edge on pin <a class="el" href="grpIntroMCU.html#wirePinSleepTr">TRX_PIN_SLP_TR</a>. If the <a class="el" href="grpPhyTx.html#phyTxTiming">timing constraint</a> cannot be ensured, the frame shall be downloaded before the pin <a class="el" href="grpIntroMCU.html#wirePinSleepTr">TRX_PIN_SLP_TR</a> is toggled. After the last byte of the frame has been sent out, the <a class="el" href="group__apiHalPHY212Const.html#ge34c1f5817526945d96c7cda6689f342">TRX_IRQ_TRX_END</a> interrupt is generated confirming that the frame was sent correctly.<p>
<div align="center">
<img src="inline_mscgraph_77.png" alt="inline_mscgraph_77" border="0" usemap="#inline_mscgraph_77.map">
<map name="inline_mscgraph_77.map"><area href="grpIntroStates.html#stPllOn" shape="rect" coords="433,26,467,39" alt="">
<area href="pgConst.html#tTR10" shape="rect" coords="460,69,495,82" alt="">
<area href="pgConst.html#t7" shape="rect" coords="160,94,177,107" alt="">
<area href="grpIntroStates.html#stTxBusy" shape="rect" coords="430,201,470,214" alt="">
<area href="pgConst.html#tSHR" shape="rect" coords="160,244,189,257" alt="">
<area href="grpIntroStates.html#stPllOn" shape="rect" coords="433,376,467,389" alt="">
</map>
</div>
 <dl class="user" compact><dt><b>Code example</b></dt><dd><div class="fragment"><pre class="fragment">    <span class="comment">/* AT86RF212::PLL_ON */</span>
    <a class="code" href="group__apiHalFuncBasic.html#g7ffbe4411fb6d28f884fd3da4c206893" title="Set the level of the SLP_TR pin.">trx_pinset_slptr</a>(1);
    <a class="code" href="group__apiHalFuncBasic.html#g7ffbe4411fb6d28f884fd3da4c206893" title="Set the level of the SLP_TR pin.">trx_pinset_slptr</a>(0);
    <span class="comment">/* AT86RF212::BUSY_TX */</span>
    <a class="code" href="group__apiHalFuncBasic.html#g9191fea0f277cb46af5ad28b67a6356d" title="Write a frame to the radio transceiver.">trx_frame_write</a>(len(frame), frame);
    <span class="comment">/* TRX_IRQ_TRX_END occurs here */</span>
    <span class="comment">/* AT86RF212::PLL_ON */</span>
</pre></div></dd></dl>
<h2><a class="anchor" name="secphy_data_request_regstart">
PHY_DATA_REQUEST_REGSTART</a></h2>
This sequence describes a frame transmission, which is initiated by writing the command <a class="el" href="group__apiHalPHY212Const.html#gd47eb7bbddce76aba1a636d6b2344997">CMD_TX_START</a> to sub register <a class="el" href="group__apiHalPHY212Sreg.html#g8d912618842812f37fc46356eff73c93">SR_TRX_CMD</a>. If the <a class="el" href="grpPhyTx.html#phyTxTiming">timing constraint</a> cannot be ensured, the frame shall be downloaded before the value <a class="el" href="group__apiHalPHY212Const.html#gd47eb7bbddce76aba1a636d6b2344997">CMD_TX_START</a> is written to sub register <a class="el" href="group__apiHalPHY212Sreg.html#g8d912618842812f37fc46356eff73c93">SR_TRX_CMD</a>. After the last byte of the frame has been sent out, the <a class="el" href="group__apiHalPHY212Const.html#ge34c1f5817526945d96c7cda6689f342">TRX_IRQ_TRX_END</a> interrupt is generated confirming that the frame was sent correctly.<p>
<div align="center">
<img src="inline_mscgraph_78.png" alt="inline_mscgraph_78" border="0" usemap="#inline_mscgraph_78.map">
<map name="inline_mscgraph_78.map"><area href="grpIntroStates.html#stPllOn" shape="rect" coords="433,26,467,39" alt="">
<area href="pgConst.html#tTR10" shape="rect" coords="460,69,495,82" alt="">
<area href="pgConst.html#tSHR" shape="rect" coords="160,94,189,107" alt="">
<area href="grpIntroStates.html#stTxBusy" shape="rect" coords="430,151,470,164" alt="">
<area href="grpIntroStates.html#stPllOn" shape="rect" coords="433,301,467,314" alt="">
</map>
</div>
 <dl class="user" compact><dt><b>Code example</b></dt><dd><div class="fragment"><pre class="fragment">    <span class="comment">/* AT86RF212::PLL_ON */</span>
    <a class="code" href="group__apiHalFuncBasic.html#g4a22a30602ea72effde4450ce80a6480" title="Write a value to a subregister.">trx_bit_write</a>(<a class="code" href="group__apiHalPHY212Sreg.html#g8d912618842812f37fc46356eff73c93">SR_TRX_CMD</a>, <a class="code" href="group__apiHalPHY212Const.html#gd47eb7bbddce76aba1a636d6b2344997">CMD_TX_START</a>);
    <span class="comment">/* AT86RF212::BUSY_TX */</span>
    <a class="code" href="group__apiHalFuncBasic.html#g9191fea0f277cb46af5ad28b67a6356d" title="Write a frame to the radio transceiver.">trx_frame_write</a>(len(frame), frame);
    <span class="comment">/* TRX_IRQ_TRX_END occurs here */</span>
    <span class="comment">/* AT86RF212::PLL_ON */</span>
</pre></div> </dd></dl>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Aug 17 13:35:01 2009 for SWPM AT86RF212 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
