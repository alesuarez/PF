<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>SWPM AT86RF212: Security Module (AES)</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="main.html">AT86RF212 Programming</a>&nbsp;&raquo&nbsp;<a class="el" href="pgSwpmAT86RF212.html">Software Programming Model</a>&nbsp;&raquo&nbsp;<a class="el" href="grpMisc.html">Extended Features</a>
  </div>
</div>
<div class="contents">
<h1><a class="anchor" name="grpAES">Security Module (AES) </a></h1>This section describes the control and usage of the AES hardware acceleration unit. For more details refer to <a class="el" href="pgRef.html#refDataSheet">section 9.1</a> <em>(Security Module (AES))</em> of the AT86RF212 datasheet.<p>
The security module can be accessed with SRAM read/write commands (see section <a class="el" href="grpIntroTransceiverAccess.html#grpIntroSRAM">SRAM Access Mode</a>) in any of the <a class="el" href="grpIntroStates.html#stTrxActive">[ACTIVE]</a> states. The functions <a class="el" href="group__apiHalFuncBasic.html#g53c5a480cc77c15e61d5b6582070d944">trx_aes_read()</a>, <a class="el" href="group__apiHalFuncBasic.html#g6da4dc8ef15aea804539e3c626644cd7">trx_aes_wrrd()</a>, <a class="el" href="group__apiHalFuncBasic.html#g80132a40aa746cff703fdfc242360581">trx_aes_write()</a> are adapted SRAM read/write functions, which take the memory organization of the security module into consideration. The fast SRAM access method is described in detail in section <a class="el" href="grpIntroTransceiverAccess.html#secFast">AES Block Access and Fast SRAM Access</a>. The following picture shows the memory map of the security module.<p>
<pre>
   +----+--------------------+
   |0x82| <a class="el" href="group__apiHalPHY212Const.html#g142a14291374c6378cb118fdacaa1b8b">AES_STATUS</a>         | (status SRAM register)
   +----+--------------------+
   |0x83| <a class="el" href="group__apiHalPHY212Const.html#g5a835fbbc845c19b88677c49a5ddb847">AES_CTRL</a>           | (configuration SRAM register)
   +----+--------------------+
   |0x84|                    |
   |    | <a class="el" href="group__apiHalPHY212Const.html#g27432ab2d7b3e0ee5b249f9a020f286a">AES_STATE_KEY</a>      | (128 bit data SRAM block)
   |0x93|                    |
   +----+--------------------+
   |0x94| <a class="el" href="group__apiHalPHY212Const.html#g9de14b055c29d18b7858fd3e2d775725">AES_CTRL_MIRROR</a>    | (configuration mirror SRAM register)
   +----+--------------------+
</pre><p>
Performing an AES operation requires the following steps:<ol type=1>
<li>Configure the security key with use case <a class="el" href="grpAES.html#secaes_set_key">AES_SET_KEY</a>.</li><li>Set the AES mode and direction with use case <a class="el" href="grpAES.html#secaes_ecb_single">AES_ECB_SINGLE_BLOCK</a>.</li><li>Transfer the data for the security operation to the security engine (see <a class="el" href="grpAES.html#secaes_ecb_single">AES_ECB_SINGLE_BLOCK</a>).</li><li>Start the security operation by setting <a class="el" href="group__apiHalPHY212Const.html#gabbd0940daff411e4b868d2b695954d6">AES_REQUEST</a> bit at SRAM register 0x94 (AES_CTRL_MIRROR).</li><li>The processed data are stored at the SRAM addresses 0x84 - 0x93.</li></ol>
<p>
<dl class="note" compact><dt><b>Note:</b></dt><dd><ul>
<li>Using the security module in <a class="el" href="grpIntroStates.html#stTrxOff">TRX_OFF</a> state requires enabling of CLKM, see section <a class="el" href="grpRf212Clkm.html">CLKM Frequency Change</a>.</li><li>The configuration steps 2 - 4 can be combined into one single SRAM access.</li><li>Using consecutive AES operations (like CBC) allows reading of the previously processed data during a SRAM write access, for details refer to <a class="el" href="grpIntroTransceiverAccess.html#secFast">AES Block Access and Fast SRAM Access</a>.</li><li>An AES run requires <a class="el" href="pgConst.html#t12">t12</a>, which further defines the wait time between AES accesses, refer to <a class="el" href="grpAES.html#secaes_ecb_multiple_timer">AES_ECB_MULTIPLE_BLOCKS</a>, <a class="el" href="grpAES.html#secaes_cbc_timer">AES_CBC</a>.</li><li>All configurations of the security module, the SRAM content and keys are reset during <a class="el" href="grpIntroStates.html#stSleep">SLEEP</a> or after a <a class="el" href="grpPhyReset.html#secreset">TRX_RESET</a>.</li></ul>
</dd></dl>
<a class="anchor" name="parm_aesmode"></a> <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>aesmode</em>&nbsp;</td><td>This parameter configures the AES operational mode, which can be {<a class="el" href="group__apiHalPHY212Const.html#gcc85fa7ca53401eba1bd750fd89fb8f1">AES_MODE_KEY</a>, <a class="el" href="group__apiHalPHY212Const.html#g80f586ff9d5f9d29ad835333ea22c8a9">AES_MODE_ECB</a>, <a class="el" href="group__apiHalPHY212Const.html#g7225765eac8a038c4b5ee829b06c431f">AES_MODE_CBC</a>}. All other values are reserved. <a class="anchor" name="parm_aesdir"></a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>aesdir</em>&nbsp;</td><td>The parameter configures the AES operation direction {<a class="el" href="group__apiHalPHY212Const.html#g2304e88cacdfceb1525993e5add51192">AES_DIR_ENCRYPT</a>, <a class="el" href="group__apiHalPHY212Const.html#ge4af679f302c32f38c24db931e2d2932">AES_DIR_DECRYPT</a>}. <a class="anchor" name="parm_aeskey"></a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>aeskey</em>&nbsp;</td><td>a data block of size <a class="el" href="group__apiHalPHY212Const.html#g2c5d69c4f50c9ae712f7579fe3ac545a">TRX_AES_BLOCK_SIZE</a>, storing the 128 bit AES key. <a class="anchor" name="parm_idata"></a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>idata</em>&nbsp;</td><td>an input data block of size <a class="el" href="group__apiHalPHY212Const.html#g2c5d69c4f50c9ae712f7579fe3ac545a">TRX_AES_BLOCK_SIZE</a>, which can be either plain text or cypher text. <a class="anchor" name="parm_idata1"></a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>idata1</em>&nbsp;</td><td>1st input data block. <a class="anchor" name="parm_idata2"></a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>idata2</em>&nbsp;</td><td>2nd input data block. <br>
... <a class="anchor" name="parm_idataN"></a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>idataN</em>&nbsp;</td><td>Nth input data block.</td></tr>
  </table>
</dl>
<a class="anchor" name="retv_aesdone"></a> <dl compact><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>aesdone</em>&nbsp;</td><td>value that indicates the current status of the AES module. {0}: operation is not finished, {1}: operation is finished. <a class="anchor" name="retv_aeserror"></a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>aeserror</em>&nbsp;</td><td>value that indicates the error status of the AES module. {0}: no error has occured, {1}: an error has occured. <a class="anchor" name="retv_odata"></a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>odata</em>&nbsp;</td><td>an output data block of size <a class="el" href="group__apiHalPHY212Const.html#g2c5d69c4f50c9ae712f7579fe3ac545a">TRX_AES_BLOCK_SIZE</a>, which can be either plain text or cypher text. <a class="anchor" name="retv_odata1"></a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>odata1</em>&nbsp;</td><td>1st output data block. <a class="anchor" name="retv_odata2"></a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>odata2</em>&nbsp;</td><td>2nd output data block. <br>
... <a class="anchor" name="retv_odataN"></a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>odataN</em>&nbsp;</td><td>Nth output data block.</td></tr>
  </table>
</dl>
<b>Use Cases:</b><ul>
<li><a class="el" href="grpAES.html#secaes_get_status">AES_GET_STATUS</a></li><li><a class="el" href="grpAES.html#secaes_set_key">AES_SET_KEY</a></li><li><a class="el" href="grpAES.html#secaes_get_key">AES_GET_KEY</a></li><li><a class="el" href="grpAES.html#secaes_ecb_single">AES_ECB_SINGLE_BLOCK</a></li><li><a class="el" href="grpAES.html#secaes_ecb_multiple_timer">AES_ECB_MULTIPLE_BLOCKS</a></li><li><a class="el" href="grpAES.html#secaes_cbc_timer">AES_CBC</a></li></ul>
<p>
<hr>
<h2><a class="anchor" name="secaes_get_status">
AES_GET_STATUS</a></h2>
The current status information of the security module (<a class="el" href="grpAES.html#retv_aesdone">aesdone</a>, <a class="el" href="grpAES.html#retv_aeserror">aeserror</a>) can be retrieved from SRAM register <a class="el" href="group__apiHalPHY212Const.html#g142a14291374c6378cb118fdacaa1b8b">AES_STATUS</a>.<p>
<div align="center">
<img src="inline_mscgraph_91.png" alt="inline_mscgraph_91" border="0" usemap="#inline_mscgraph_91.map">
<map name="inline_mscgraph_91.map"><area href="grpIntroStates.html#stTrxActive" shape="rect" coords="427,26,473,39" alt="">
</map>
</div>
 <dl class="user" compact><dt><b>Code example</b></dt><dd><div class="fragment"><pre class="fragment">    <span class="comment">/* AT86RF212::[ACTIVE] */</span>
    <a class="code" href="group__apiHalFuncBasic.html#g9cefef2438958ba66d3696eb01aa8470" title="Read data from SRAM.">trx_sram_read</a>(<a class="code" href="group__apiHalPHY212Const.html#g142a14291374c6378cb118fdacaa1b8b">AES_STATUS</a>, 1, stat);
    aesdone=stat &amp; 1;
    aeserror=(stat&gt;&gt;7) &amp; 1;
</pre></div></dd></dl>
<h2><a class="anchor" name="secaes_set_key">
AES_SET_KEY</a></h2>
The key is configured by the following steps:<ol type=1>
<li>by configuring <a class="el" href="grpAES.html#parm_aesmode">aesmode</a> to <a class="el" href="group__apiHalPHY212Const.html#gcc85fa7ca53401eba1bd750fd89fb8f1">AES_MODE_KEY</a> and</li><li>store the key (<a class="el" href="grpAES.html#parm_aeskey">aeskey</a>) with a length of 128 bit to SRAM register <a class="el" href="group__apiHalPHY212Const.html#g27432ab2d7b3e0ee5b249f9a020f286a">AES_STATE_KEY</a>.</li></ol>
<p>
This steps can be combined using a single SRAM access, implemented with the function <a class="el" href="group__apiHalFuncBasic.html#g80132a40aa746cff703fdfc242360581">trx_aes_write()</a> (for details refer to section <a class="el" href="grpIntroTransceiverAccess.html#secFast">AES Block Access and Fast SRAM Access</a>).<p>
<div align="center">
<img src="inline_mscgraph_92.png" alt="inline_mscgraph_92" border="0" usemap="#inline_mscgraph_92.map">
<map name="inline_mscgraph_92.map"><area href="grpIntroStates.html#stTrxActive" shape="rect" coords="427,26,473,39" alt="">
</map>
</div>
 <dl class="user" compact><dt><b>Code example</b></dt><dd><div class="fragment"><pre class="fragment">    <span class="comment">/* AT86RF212::[ACTIVE] */</span>
    <a class="code" href="group__apiHalFuncBasic.html#g80132a40aa746cff703fdfc242360581" title="Write data to the AES block.">trx_aes_write</a>(<a class="code" href="group__apiHalPHY212Const.html#gcc85fa7ca53401eba1bd750fd89fb8f1">AES_MODE_KEY</a>, 0, aeskey);
</pre></div></dd></dl>
<h2><a class="anchor" name="secaes_get_key">
AES_GET_KEY</a></h2>
The current 128 bit AES key (<a class="el" href="grpAES.html#parm_aeskey">aeskey</a>) can be retrieved from SRAM register <a class="el" href="group__apiHalPHY212Const.html#g27432ab2d7b3e0ee5b249f9a020f286a">AES_STATE_KEY</a> of the security module, e.g. after the current AES operation is finished (see <a class="el" href="grpAES.html#secaes_get_status">AES_GET_STATUS</a>).<p>
<div align="center">
<img src="inline_mscgraph_93.png" alt="inline_mscgraph_93" border="0" usemap="#inline_mscgraph_93.map">
<map name="inline_mscgraph_93.map"><area href="grpIntroStates.html#stTrxActive" shape="rect" coords="427,26,473,39" alt="">
</map>
</div>
 <dl class="user" compact><dt><b>Code example</b></dt><dd><div class="fragment"><pre class="fragment">    <span class="comment">/* AT86RF212::[ACTIVE] */</span>
    <a class="code" href="group__apiHalFuncBasic.html#g53c5a480cc77c15e61d5b6582070d944" title="Read data from AES block.">trx_aes_read</a>(<a class="code" href="group__apiHalPHY212Const.html#gcc85fa7ca53401eba1bd750fd89fb8f1">AES_MODE_KEY</a>, aeskey);
</pre></div></dd></dl>
<h2><a class="anchor" name="secaes_ecb_single">
AES_ECB_SINGLE_BLOCK</a></h2>
The ECB mode is the default operating mode of the security module. The use case illustrates the processing of a single data block while using the following parameters:<ol type=1>
<li><a class="el" href="grpAES.html#parm_aesmode">aesmode</a>=AES_MODE_ECB</li><li><a class="el" href="grpAES.html#parm_aesdir">aesdir</a> direction of the AES operation</li><li><a class="el" href="grpAES.html#parm_idata">idata</a> input data block</li><li><a class="el" href="grpAES.html#retv_odata">odata</a> result data block</li></ol>
<p>
<div align="center">
<img src="inline_mscgraph_94.png" alt="inline_mscgraph_94" border="0" usemap="#inline_mscgraph_94.map">
<map name="inline_mscgraph_94.map"><area href="grpIntroStates.html#stTrxActive" shape="rect" coords="427,26,473,39" alt="">
<area href="pgConst.html#t12" shape="rect" coords="160,94,183,107" alt="">
</map>
</div>
 <dl class="user" compact><dt><b>Code example</b></dt><dd><div class="fragment"><pre class="fragment">    <span class="comment">/* AT86RF212::[ACTIVE] */</span>
    aesctl = <a class="code" href="group__apiHalPHY212Const.html#g80f586ff9d5f9d29ad835333ea22c8a9">AES_MODE_ECB</a> | aesdir;
    <a class="code" href="group__apiHalFuncBasic.html#g80132a40aa746cff703fdfc242360581" title="Write data to the AES block.">trx_aes_write</a>(aesctl, 1, idata);
    delay(t12);
    <a class="code" href="group__apiHalFuncBasic.html#g53c5a480cc77c15e61d5b6582070d944" title="Read data from AES block.">trx_aes_read</a>(aesctl, odata);
</pre></div></dd></dl>
<h2><a class="anchor" name="secaes_ecb_multiple_timer">
AES_ECB_MULTIPLE_BLOCKS</a></h2>
The use case illustrates the processing of several data blocks in the ECB operational mode with the following parameters:<p>
<ol type=1>
<li><a class="el" href="grpAES.html#parm_aesmode">aesmode</a>=AES_MODE_ECB</li><li><a class="el" href="grpAES.html#parm_aesdir">aesdir</a> direction of the AES operation</li><li><a class="el" href="grpAES.html#parm_idata1">idata1</a>,...,<a class="el" href="grpAES.html#parm_idataN">idataN</a> input data blocks</li><li><a class="el" href="grpAES.html#retv_odata1">odata1</a>,...,<a class="el" href="grpAES.html#retv_odataN">odataN</a> result data blocks</li></ol>
<p>
<div align="center">
<img src="inline_mscgraph_95.png" alt="inline_mscgraph_95" border="0" usemap="#inline_mscgraph_95.map">
<map name="inline_mscgraph_95.map"><area href="grpIntroStates.html#stTrxActive" shape="rect" coords="427,26,473,39" alt="">
<area href="pgConst.html#t12" shape="rect" coords="160,94,183,107" alt="">
<area href="pgConst.html#t12" shape="rect" coords="160,169,183,182" alt="">
<area href="pgConst.html#t12" shape="rect" coords="160,269,183,282" alt="">
</map>
</div>
 <dl class="user" compact><dt><b>Code example</b></dt><dd><div class="fragment"><pre class="fragment">    <span class="comment">/* AT86RF212::[ACTIVE] */</span>
    aesctl = <a class="code" href="group__apiHalPHY212Const.html#g80f586ff9d5f9d29ad835333ea22c8a9">AES_MODE_ECB</a> | aesdir;
    <a class="code" href="group__apiHalFuncBasic.html#g80132a40aa746cff703fdfc242360581" title="Write data to the AES block.">trx_aes_write</a>(aesctl, 1, idata1);
    delay(t12);
    <a class="code" href="group__apiHalFuncBasic.html#g6da4dc8ef15aea804539e3c626644cd7" title="Write and read data from AES block simultaneously.">trx_aes_wrrd</a>(aesctl, 1, idata2, odata1);
    delay(t12);
    <a class="code" href="group__apiHalFuncBasic.html#g6da4dc8ef15aea804539e3c626644cd7" title="Write and read data from AES block simultaneously.">trx_aes_wrrd</a>(aesctl, 1, idata3, odata2);
    proc_other_blocks();
    delay(t12);
    <a class="code" href="group__apiHalFuncBasic.html#g53c5a480cc77c15e61d5b6582070d944" title="Read data from AES block.">trx_aes_read</a>(aesctl, odataN);
</pre></div></dd></dl>
<h2><a class="anchor" name="secaes_cbc_timer">
AES_CBC</a></h2>
The CBC mode of the security module is based on the ECB operating mode. The use case illustrates the processing of several data blocks in the CBC operational mode with the following parameters:<p>
<ol type=1>
<li><a class="el" href="grpAES.html#parm_aesmode">aesmode</a> = AES_MODE_CBC</li><li><a class="el" href="grpAES.html#parm_aesdir">aesdir</a> direction of the AES operation</li><li><a class="el" href="grpAES.html#parm_idata1">idata1</a>,...,<a class="el" href="grpAES.html#parm_idataN">idataN</a> input data blocks</li><li><a class="el" href="grpAES.html#retv_odata1">odata1</a>,...,<a class="el" href="grpAES.html#retv_odataN">odataN</a> result data blocks</li></ol>
<p>
<div align="center">
<img src="inline_mscgraph_96.png" alt="inline_mscgraph_96" border="0" usemap="#inline_mscgraph_96.map">
<map name="inline_mscgraph_96.map"><area href="grpIntroStates.html#stTrxActive" shape="rect" coords="427,26,473,39" alt="">
<area href="pgConst.html#t12" shape="rect" coords="160,94,183,107" alt="">
<area href="pgConst.html#t12" shape="rect" coords="160,194,183,207" alt="">
<area href="pgConst.html#t12" shape="rect" coords="160,294,183,307" alt="">
</map>
</div>
 <dl class="user" compact><dt><b>Code example</b></dt><dd><div class="fragment"><pre class="fragment">    <span class="comment">/* AT86RF212::[ACTIVE] */</span>
    aesctl = <a class="code" href="group__apiHalPHY212Const.html#g80f586ff9d5f9d29ad835333ea22c8a9">AES_MODE_ECB</a> | aesdir;
    <a class="code" href="group__apiHalFuncBasic.html#g80132a40aa746cff703fdfc242360581" title="Write data to the AES block.">trx_aes_write</a>(aesctl, 1, idata1);
    aesctl = <a class="code" href="group__apiHalPHY212Const.html#g7225765eac8a038c4b5ee829b06c431f">AES_MODE_CBC</a> | aesdir;
    <a class="code" href="group__apiHalFuncBasic.html#g6da4dc8ef15aea804539e3c626644cd7" title="Write and read data from AES block simultaneously.">trx_aes_wrrd</a>(aesctl, 1, idata2, odata1);
    delay(t12);
    <a class="code" href="group__apiHalFuncBasic.html#g6da4dc8ef15aea804539e3c626644cd7" title="Write and read data from AES block simultaneously.">trx_aes_wrrd</a>(aesctl, 1, idata3, odata2);
    proc_other_blocks();
    delay(t12);
    <a class="code" href="group__apiHalFuncBasic.html#g53c5a480cc77c15e61d5b6582070d944" title="Read data from AES block.">trx_aes_read</a>(aesctl, odataN);
</pre></div> </dd></dl>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Aug 17 13:35:01 2009 for SWPM AT86RF212 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
