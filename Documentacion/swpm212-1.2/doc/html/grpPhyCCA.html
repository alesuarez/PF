<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>SWPM AT86RF212: CCA Measurement</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="main.html">AT86RF212 Programming</a>&nbsp;&raquo&nbsp;<a class="el" href="pgSwpmAT86RF212.html">Software Programming Model</a>&nbsp;&raquo&nbsp;<a class="el" href="grpPhyCcaEdRssi.html">RSSI, ED, CCA Measurement, and RX Status Information</a>
  </div>
</div>
<div class="contents">
<h1><a class="anchor" name="grpPhyCCA">CCA Measurement </a></h1>This section describes how a CCA measurement (Clear Channel Assesment) for the current RF channel is done. The result of the CCA measurement is used in the CSMA-CA algorithm (Carrier Sense Multiple Access - Collision Avoidance) to ensure that no transmission of another station is disturbed by the own frame transmission.<p>
The CCA measurement, which is described in more detail in <a class="el" href="pgRef.html#refDataSheet">section 6.6</a> <em>(Clear Channel Assessment)</em> of the AT86RF212 datasheet, is controlled with two parameters, <em><a class="el" href="grpPhyCCA.html#ccaParMode">mode</a></em> and <em><a class="el" href="grpPhyCCA.html#ccaParEdthrs">edthrs</a></em>:<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>mode</em>&nbsp;</td><td><a class="anchor" name="ccaParMode"></a> The CCA-Mode parameter is set in the sub register <a class="el" href="group__apiHalPHY212Sreg.html#g5f1683f4ba650a0737bf0a4cce54da51">SR_CCA_MODE</a> and has the following meaning:<br>
 <table border="1" cellspacing="3" cellpadding="3">
<tr>
<td valign="top" align="center" width="20%>"><a class="anchor" name="ccaMode0"></a><pre>mode=0</pre> </td><td>Carrier sense or energy above threshold (Mode 3a).<br>
 <em>CCA shall report a busy medium only upon the detection of a signal with the modulation and spreading characteristics of IEEE 802.15.4 OR energy above the ED threshold. </em>   </td></tr>
<tr>
<td valign="top" align="center" width="20%>"><a class="anchor" name="ccaMode1"></a><pre>mode=1</pre> </td><td>Energy above threshold.<br>
 <em>CCA shall report a busy medium upon detecting any energy above the ED threshold.</em>   </td></tr>
<tr>
<td valign="top" align="center"><a class="anchor" name="ccaMode2"></a><pre>mode=2</pre> </td><td>Carrier sense only.<br>
 <em>CCA shall report a busy medium only upon the detection of a signal with the modulation and spreading characteristics of IEEE 802.15.4. This signal may be above or below the ED threshold.</em>   </td></tr>
<tr>
<td valign="top" align="center"><a class="anchor" name="ccaMode3"></a><pre>mode=3</pre> </td><td>Carrier sense and energy above threshold (Mode 3b).<br>
 <em>CCA shall report a busy medium only upon the detection of a signal with the modulation and spreading characteristics of IEEE 802.15.4 AND energy above the ED threshold. </em>   </td></tr>
</table>
</td></tr>
    <tr><td valign="top"></td><td valign="top"><em>edthrs</em>&nbsp;</td><td><a class="anchor" name="ccaParEdthrs"></a> If a signal is present, which has an energy value above the energy threshold, the CCA measurement reports a busy medium. The value <code>edthrs</code> is a 4 bit value, which is converted to an RF input power value by <br>
<code>P<sub>RF</sub> = <a class="el" href="pgConst.html#secConstRSSI">RSSI_BASE_VAL</a> + 2*edthrs</code>. This parameter is <em>not</em> relevant for <a class="el" href="grpPhyCCA.html#ccaMode2">mode=2</a>.</td></tr>
  </table>
</dl>
<a class="anchor" name="ccaRet"></a><p>
The CCA measurement itself is carried out with sequence <a class="el" href="grpPhyCCA.html#secphy_cca_request">PHY_DO_CCA</a>. It returns two values, <em><a class="el" href="grpPhyCCA.html#ccaRetCCA">cca</a></em> and <em><a class="el" href="grpPhyCCA.html#ccaRetDone">done</a></em>: <dl compact><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>done</em>&nbsp;</td><td><a class="anchor" name="ccaRetDone"></a> The end of a manually initiated CCA measurement is signalled by <a class="el" href="group__apiHalPHY212Const.html#g4dc830446c62bea8ebfa172b61677776">TRX_IRQ_CCA_ED_DONE</a>. Alternatively, sub register <a class="el" href="group__apiHalPHY212Sreg.html#g339adcb56a6dcbb09439a33ea694a34a">SR_CCA_DONE</a> can be read.<ul>
<li>0 : a previously started CCA measurement is not (yet) completed</li><li>1 : a previously started CCA measurement is completed correctly</li></ul>
</td></tr>
    <tr><td valign="top"></td><td valign="top"><em>stat</em>&nbsp;</td><td><a class="anchor" name="ccaRetCCA"></a> This parameter is retrieved from the sub register <a class="el" href="group__apiHalPHY212Sreg.html#g538dc968f58c078b4e29d4d70d793354">SR_CCA_STATUS</a> and has the following meaning:<ul>
<li>0 : medium is busy</li><li>1 : medium is free</li></ul>
</td></tr>
  </table>
</dl>
<b>Use Cases:</b><ul>
<li><a class="el" href="grpPhyCCA.html#secphy_set_ccamode">PHY_SET_CCA_CFG</a></li><li><a class="el" href="grpPhyCCA.html#secphy_get_ccamode">PHY_GET_CCA_CFG</a></li><li><a class="el" href="grpPhyCCA.html#secphy_cca_request">PHY_DO_CCA</a></li></ul>
<p>
<hr>
<h2><a class="anchor" name="secphy_set_ccamode">
PHY_SET_CCA_CFG</a></h2>
This sequence sets the parameters <em><a class="el" href="grpPhyCCA.html#ccaParMode">mode</a></em> and <em><a class="el" href="grpPhyCCA.html#ccaParEdthrs">edthrs</a></em> for the CCA measurement.<p>
<div align="center">
<img src="inline_mscgraph_72.png" alt="inline_mscgraph_72" border="0" usemap="#inline_mscgraph_72.map">
<map name="inline_mscgraph_72.map"><area href="grpIntroStates.html#stTrxConfig" shape="rect" coords="427,26,473,39" alt="">
</map>
</div>
 <dl class="user" compact><dt><b>Code example</b></dt><dd><div class="fragment"><pre class="fragment">    <span class="comment">/* AT86RF212::[CONFIG] */</span>
    <a class="code" href="group__apiHalFuncBasic.html#g4a22a30602ea72effde4450ce80a6480" title="Write a value to a subregister.">trx_bit_write</a>(<a class="code" href="group__apiHalPHY212Sreg.html#g5f1683f4ba650a0737bf0a4cce54da51">SR_CCA_MODE</a>, mode);
    <a class="code" href="group__apiHalFuncBasic.html#g4a22a30602ea72effde4450ce80a6480" title="Write a value to a subregister.">trx_bit_write</a>(<a class="code" href="group__apiHalPHY212Sreg.html#g5d49fade58407955545f861fc65078b9">SR_CCA_ED_THRES</a>, edthrs);
</pre></div></dd></dl>
<h2><a class="anchor" name="secphy_get_ccamode">
PHY_GET_CCA_CFG</a></h2>
This sequence returns the currently configured parameters, <em><a class="el" href="grpPhyCCA.html#ccaParMode">mode</a></em> and <em><a class="el" href="grpPhyCCA.html#ccaParEdthrs">edthrs</a></em>.<p>
<div align="center">
<img src="inline_mscgraph_73.png" alt="inline_mscgraph_73" border="0" usemap="#inline_mscgraph_73.map">
<map name="inline_mscgraph_73.map"><area href="grpIntroStates.html#stTrxActive" shape="rect" coords="427,26,473,39" alt="">
</map>
</div>
 <dl class="user" compact><dt><b>Code example</b></dt><dd><div class="fragment"><pre class="fragment">    <span class="comment">/* AT86RF212::[ACTIVE] */</span>
    mode = <a class="code" href="group__apiHalFuncBasic.html#ge7ea3d090b5d26b73a5c62e2e61e0231" title="Read a value from a subregister.">trx_bit_read</a>(<a class="code" href="group__apiHalPHY212Sreg.html#g5f1683f4ba650a0737bf0a4cce54da51">SR_CCA_MODE</a>);
    edthrs = <a class="code" href="group__apiHalFuncBasic.html#ge7ea3d090b5d26b73a5c62e2e61e0231" title="Read a value from a subregister.">trx_bit_read</a>(<a class="code" href="group__apiHalPHY212Sreg.html#g5d49fade58407955545f861fc65078b9">SR_CCA_ED_THRES</a>);
</pre></div></dd></dl>
<h2><a class="anchor" name="secphy_cca_request">
PHY_DO_CCA</a></h2>
After the configuration (see <a class="el" href="grpPhyCCA.html#secphy_set_ccamode">PHY_SET_CCA_CFG</a>), a CCA measurement can be started in one of the <a class="el" href="grpIntroStates.html#stTrxRxBasic">[RX_BASIC]</a> states by writing value 1 to the sub register <a class="el" href="group__apiHalPHY212Sreg.html#ge6e0a8254e3c2dadc1b727c43d204d1f">SR_CCA_REQUEST</a>. The measurement is finished after <a class="el" href="pgConst.html#tTR28">tTR28</a>.<p>
<div align="center">
<img src="inline_mscgraph_74.png" alt="inline_mscgraph_74" border="0" usemap="#inline_mscgraph_74.map">
<map name="inline_mscgraph_74.map"><area href="grpIntroStates.html#stTrxRxBasic" shape="rect" coords="421,26,479,39" alt="">
<area href="pgConst.html#tTR28" shape="rect" coords="160,69,195,82" alt="">
</map>
</div>
 <dl class="user" compact><dt><b>Code example</b></dt><dd><div class="fragment"><pre class="fragment">    <span class="comment">/* AT86RF212::[RX_BASIC] */</span>
    <a class="code" href="group__apiHalFuncBasic.html#g4a22a30602ea72effde4450ce80a6480" title="Write a value to a subregister.">trx_bit_write</a>(<a class="code" href="group__apiHalPHY212Sreg.html#ge6e0a8254e3c2dadc1b727c43d204d1f">SR_CCA_REQUEST</a>, 1);
    delay(tTR28);
    stat = <a class="code" href="group__apiHalFuncBasic.html#ge7ea3d090b5d26b73a5c62e2e61e0231" title="Read a value from a subregister.">trx_bit_read</a>(<a class="code" href="group__apiHalPHY212Sreg.html#g538dc968f58c078b4e29d4d70d793354">SR_CCA_STATUS</a>);
</pre></div> </dd></dl>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Aug 17 13:35:01 2009 for SWPM AT86RF212 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
