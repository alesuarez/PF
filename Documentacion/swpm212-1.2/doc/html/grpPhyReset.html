<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>SWPM AT86RF212: Reset</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="main.html">AT86RF212 Programming</a>&nbsp;&raquo&nbsp;<a class="el" href="pgSwpmAT86RF212.html">Software Programming Model</a>&nbsp;&raquo&nbsp;<a class="el" href="grpSetup.html">Setup</a>
  </div>
</div>
<div class="contents">
<h1><a class="anchor" name="grpPhyReset">Reset </a></h1><b>Use Cases:</b><ul>
<li><a class="el" href="grpPhyReset.html#secpower_on_reset">POWER_ON_RESET</a></li><li><a class="el" href="grpPhyReset.html#secreset">TRX_RESET</a></li><li><a class="el" href="grpPhyReset.html#secstate_reset">STATE_MACHINE_RESET</a> <hr>
</li></ul>
<h2><a class="anchor" name="secpower_on_reset">
POWER_ON_RESET</a></h2>
The following programming sequence should be executed after power-on to completely reset the radio transceiver. The MCU can not count on CLKM before finalization of this sequence.<p>
Nevertheless, this sequence can be safely executed from any state.<p>
If the <a class="el" href="grpIrqAwake.html">Awake Interrupt</a> is explicitely enabled before writing <a class="el" href="group__apiHalPHY212Const.html#g2f2b663a799906d316824bba67572502">CMD_TRX_OFF</a>, the interrupt occurs, when the radio transceiver has reached the state <a class="el" href="group__apiHalPHY212Const.html#gd9aff3d987888b9d1bcb9fc12d2c996e">TRX_OFF</a>.<p>
<dl class="note" compact><dt><b>Note:</b></dt><dd>It is recommended but not mandatory to use the <a class="el" href="grpIrqAwake.html">Awake Interrupt</a>. Instead, a timer can be used to wait until state <a class="el" href="group__apiHalPHY212Const.html#gd9aff3d987888b9d1bcb9fc12d2c996e">TRX_OFF</a> is reached.</dd></dl>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>clkrst</em>&nbsp;</td><td>A constant with value 0x19, which represents<ul>
<li><a class="el" href="group__apiHalPHY212Sreg.html#g3517409068f4c36eedae73ed8ffead13">SR_CLKM_SHA_SEL</a> = 1</li><li><a class="el" href="group__apiHalPHY212Sreg.html#gc108f260911d536daba845f79a0c7eff">SR_CLKM_CTRL</a> = 1 (1MHz)</li></ul>
</td></tr>
  </table>
</dl>
<div align="center">
<img src="inline_mscgraph_4.png" alt="inline_mscgraph_4" border="0" usemap="#inline_mscgraph_4.map">
<map name="inline_mscgraph_4.map"><area href="grpIntroStates.html#stPOn" shape="rect" coords="439,26,461,39" alt="">
<area href="pgConst.html#t10" shape="rect" coords="160,169,183,182" alt="">
<area href="pgConst.html#tTR13" shape="rect" coords="160,294,195,307" alt="">
<area href="grpIntroStates.html#stTrxOff" shape="rect" coords="430,351,470,364" alt="">
</map>
</div>
 <dl class="user" compact><dt><b>Code example</b></dt><dd><div class="fragment"><pre class="fragment">    <span class="comment">/* AT86RF212::P_ON */</span>
    <a class="code" href="group__apiHalFuncBasic.html#g7ffbe4411fb6d28f884fd3da4c206893" title="Set the level of the SLP_TR pin.">trx_pinset_slptr</a>(0);
    <a class="code" href="group__apiHalFuncBasic.html#gd368880e4639eddd32ae33d3b658c626" title="Set the level of the RESET pin.">trx_pinset_reset</a>(1);
    delay_us(400);
    <a class="code" href="group__apiHalFuncBasic.html#gd368880e4639eddd32ae33d3b658c626" title="Set the level of the RESET pin.">trx_pinset_reset</a>(0);
    delay(t10);
    <a class="code" href="group__apiHalFuncBasic.html#gd368880e4639eddd32ae33d3b658c626" title="Set the level of the RESET pin.">trx_pinset_reset</a>(1);
    <a class="code" href="group__apiHalFuncBasic.html#g63cd512542173c0a69f2ead0890defed" title="Write a value to a register.">trx_reg_write</a>(<a class="code" href="group__apiHalPHY212Reg.html#g5025f89755df39a2fdede980b2907eff">RG_TRX_CTRL_0</a>, clkrst);
    <a class="code" href="group__apiHalFuncBasic.html#g63cd512542173c0a69f2ead0890defed" title="Write a value to a register.">trx_reg_write</a>(<a class="code" href="group__apiHalPHY212Reg.html#g9154e18a2399240c300da352be8c14c5">RG_TRX_STATE</a>, <a class="code" href="group__apiHalPHY212Const.html#g8ecc63755abb125691b00426cba7fe41">CMD_FORCE_TRX_OFF</a>);
    delay(tTR13);
    <span class="comment">/* AT86RF212::TRX_OFF */</span>
    state = <a class="code" href="group__apiHalFuncBasic.html#ge7ea3d090b5d26b73a5c62e2e61e0231" title="Read a value from a subregister.">trx_bit_read</a>(<a class="code" href="group__apiHalPHY212Sreg.html#gbb9dcc6f85b1154d76645b5de64d4835">SR_TRX_STATUS</a>);
    ASSERT(state==<a class="code" href="group__apiHalPHY212Const.html#gd9aff3d987888b9d1bcb9fc12d2c996e">TRX_OFF</a>);
</pre></div></dd></dl>
<h2><a class="anchor" name="secreset">
TRX_RESET</a></h2>
This routine will bring the radio transceiver into a known state, e.g. in case of a fatal error. The use case assumes, that the radio transceiver is in one of the <a class="el" href="grpIntroStates.html#stTrxActive">[ACTIVE]</a> states and will do a reset, so that all registers get initialized with their default values.<p>
Because after reset, the interrupt <a class="el" href="group__apiHalPHY212Const.html#g0008ea967147950dd4f613a2a80adb36">TRX_IRQ_AWAKE_END</a> is disabled, it needs to be explicitely enabled by writing the <a class="el" href="group__apiHalPHY212Reg.html#g905b648376932649f2af990f20a03df6">RG_IRQ_MASK</a> register.<p>
<dl class="note" compact><dt><b>Note:</b></dt><dd>It is recommended but not mandatory using the <a class="el" href="group__apiHalPHY212Const.html#g0008ea967147950dd4f613a2a80adb36">TRX_IRQ_AWAKE_END</a>. Instead, a timer can be used to wait until state <a class="el" href="group__apiHalPHY212Const.html#gd9aff3d987888b9d1bcb9fc12d2c996e">TRX_OFF</a> is reached.</dd></dl>
<div align="center">
<img src="inline_mscgraph_5.png" alt="inline_mscgraph_5" border="0" usemap="#inline_mscgraph_5.map">
<map name="inline_mscgraph_5.map"><area href="grpIntroStates.html#stTrxActive" shape="rect" coords="427,26,473,39" alt="">
<area href="pgConst.html#t10" shape="rect" coords="160,94,183,107" alt="">
<area href="pgConst.html#tTR13" shape="rect" coords="160,194,195,207" alt="">
<area href="grpIntroStates.html#stTrxOff" shape="rect" coords="430,276,470,289" alt="">
</map>
</div>
 <dl class="user" compact><dt><b>Code example</b></dt><dd><div class="fragment"><pre class="fragment">    <span class="comment">/* AT86RF212::[ACTIVE] */</span>
    <a class="code" href="group__apiHalFuncBasic.html#gd368880e4639eddd32ae33d3b658c626" title="Set the level of the RESET pin.">trx_pinset_reset</a>(0);
    <a class="code" href="group__apiHalFuncBasic.html#g7ffbe4411fb6d28f884fd3da4c206893" title="Set the level of the SLP_TR pin.">trx_pinset_slptr</a>(0);
    delay(t10);
    <a class="code" href="group__apiHalFuncBasic.html#gd368880e4639eddd32ae33d3b658c626" title="Set the level of the RESET pin.">trx_pinset_reset</a>(1);
    <a class="code" href="group__apiHalFuncBasic.html#g63cd512542173c0a69f2ead0890defed" title="Write a value to a register.">trx_reg_write</a>(<a class="code" href="group__apiHalPHY212Reg.html#g905b648376932649f2af990f20a03df6">RG_IRQ_MASK</a>, <a class="code" href="group__apiHalPHY212Const.html#g0008ea967147950dd4f613a2a80adb36" title="Signals the end of the awake process.">TRX_IRQ_AWAKE_END</a>);
    delay(tTR13);
    <span class="comment">/* AT86RF212::TRX_OFF */</span>
    state = <a class="code" href="group__apiHalFuncBasic.html#ge7ea3d090b5d26b73a5c62e2e61e0231" title="Read a value from a subregister.">trx_bit_read</a>(<a class="code" href="group__apiHalPHY212Sreg.html#gbb9dcc6f85b1154d76645b5de64d4835">SR_TRX_STATUS</a>);
    ASSERT(state==<a class="code" href="group__apiHalPHY212Const.html#gd9aff3d987888b9d1bcb9fc12d2c996e">TRX_OFF</a>);
</pre></div></dd></dl>
<h2><a class="anchor" name="secstate_reset">
STATE_MACHINE_RESET</a></h2>
This command sequence is executed in order to reset the state machine of the radio transceiver to state <a class="el" href="group__apiHalPHY212Const.html#gd9aff3d987888b9d1bcb9fc12d2c996e">TRX_OFF</a>. With this procedure any transaction in progress (e.g. if the radio transceiver is in one of the <a class="el" href="grpIntroStates.html#stTrxBusy">[BUSY]</a> states) is canceled immediately.<p>
All other register values (channel, power, ...) of the radio transceiver will not be affected by this procedure.<p>
The state machine reset is identical to the procedure described in <a class="el" href="grpStateTrxOff.html#secplme_force_trx_off_at_pll_active">PHY_FORCE_[ACTIVE]__TRX_OFF</a>.<p>
<dl class="note" compact><dt><b>Note:</b></dt><dd>Alternatively, it is possible to use <a class="el" href="group__apiHalPHY212Const.html#g12eaacbac3b035bafe907c53dbce70dd">CMD_FORCE_PLL_ON</a> as described in <a class="el" href="grpStateTxOn.html#secplme_force_pll_on_at_active">PHY_FORCE_[ACTIVE]__PLL_ON</a>. In contrast to <a class="el" href="group__apiHalPHY212Const.html#g8ecc63755abb125691b00426cba7fe41">CMD_FORCE_TRX_OFF</a> this command does not disable the PLL and the analog voltage regulator AVREG.</dd></dl>
<div align="center">
<img src="inline_mscgraph_6.png" alt="inline_mscgraph_6" border="0" usemap="#inline_mscgraph_6.map">
<map name="inline_mscgraph_6.map"><area href="grpIntroStates.html#stTrxActive" shape="rect" coords="427,26,473,39" alt="">
<area href="pgConst.html#tTR12" shape="rect" coords="160,94,195,107" alt="">
<area href="grpIntroStates.html#stTrxOff" shape="rect" coords="430,151,470,164" alt="">
</map>
</div>
 <dl class="user" compact><dt><b>Code example</b></dt><dd><div class="fragment"><pre class="fragment">    <span class="comment">/* AT86RF212::[ACTIVE] */</span>
    <a class="code" href="group__apiHalFuncBasic.html#g7ffbe4411fb6d28f884fd3da4c206893" title="Set the level of the SLP_TR pin.">trx_pinset_slptr</a>(0);
    <a class="code" href="group__apiHalFuncBasic.html#g4a22a30602ea72effde4450ce80a6480" title="Write a value to a subregister.">trx_bit_write</a>(<a class="code" href="group__apiHalPHY212Sreg.html#g8d912618842812f37fc46356eff73c93">SR_TRX_CMD</a>, <a class="code" href="group__apiHalPHY212Const.html#g8ecc63755abb125691b00426cba7fe41">CMD_FORCE_TRX_OFF</a>);
    delay(tTR12);
    <span class="comment">/* AT86RF212::TRX_OFF */</span>
    trxstat = <a class="code" href="group__apiHalFuncBasic.html#ge7ea3d090b5d26b73a5c62e2e61e0231" title="Read a value from a subregister.">trx_bit_read</a>(<a class="code" href="group__apiHalPHY212Sreg.html#gbb9dcc6f85b1154d76645b5de64d4835">SR_TRX_STATUS</a>);
    ASSERT(trxstat==<a class="code" href="group__apiHalPHY212Const.html#gd9aff3d987888b9d1bcb9fc12d2c996e">TRX_OFF</a>);
</pre></div> </dd></dl>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Aug 17 13:34:59 2009 for SWPM AT86RF212 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
