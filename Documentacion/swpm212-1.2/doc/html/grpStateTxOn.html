<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>SWPM AT86RF212: Transitions to State PLL_ON</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="main.html">AT86RF212 Programming</a>&nbsp;&raquo&nbsp;<a class="el" href="pgSwpmAT86RF212.html">Software Programming Model</a>&nbsp;&raquo&nbsp;<a class="el" href="grpState.html">State Changes</a>
  </div>
</div>
<div class="contents">
<h1><a class="anchor" name="grpStateTxOn">Transitions to State PLL_ON </a></h1>This section describes how the state <a class="el" href="grpIntroStates.html#stPllOn">PLL_ON</a> is entered. There are two commands how to get into this state.<p>
<ol type=1>
<li>Writing <a class="el" href="group__apiHalPHY212Const.html#g86eb3f35dbb0833379e005d0a934ed95">CMD_PLL_ON</a> to sub register <a class="el" href="group__apiHalPHY212Sreg.html#g8d912618842812f37fc46356eff73c93">SR_TRX_CMD</a> requests a state change towards <a class="el" href="grpIntroStates.html#stPllOn">PLL_ON</a>. If the radio transceiver is in one of the <a class="el" href="grpIntroStates.html#stTrxBusy">[BUSY]</a> states, the ongoing transaction will be finished before the state change occurs. Otherwise, the state transition is executed immediately. The following transitions are defined:<ul>
<li><a class="el" href="grpStateTxOn.html#secplme_set_trx_state_txon_at_trxoff">PHY_STATE_TRX_OFF__PLL_ON</a></li><li><a class="el" href="grpStateTxOn.html#secplme_set_trx_state_txon_at_pll_active">PHY_STATE_[PLL_ACTIVE]__PLL_ON</a></li><li><a class="el" href="grpStateTxOn.html#secplme_set_trx_state_txon_at_busynotrxaack">PHY_STATE_[BUSY]__PLL_ON</a></li><li><a class="el" href="grpStateTxOn.html#secplme_set_trx_state_txon_at_busy">PHY_STATE_BUSY_RX_AACK__PLL_ON</a></li></ul>
</li><li>Writing <a class="el" href="group__apiHalPHY212Const.html#g12eaacbac3b035bafe907c53dbce70dd">CMD_FORCE_PLL_ON</a> to sub register <a class="el" href="group__apiHalPHY212Sreg.html#g8d912618842812f37fc46356eff73c93">SR_TRX_CMD</a> causes an immediate transition. In this case, any ongoing transaction in one of the <a class="el" href="grpIntroStates.html#stPllOn">PLL_ON</a> states is canceled and the state change is done.<ul>
<li><a class="el" href="grpStateTxOn.html#secplme_force_pll_on_at_active">PHY_FORCE_[ACTIVE]__PLL_ON</a></li></ul>
</li></ol>
<p>
<hr>
<h2><a class="anchor" name="secplme_set_trx_state_txon_at_trxoff">
PHY_STATE_TRX_OFF__PLL_ON</a></h2>
If the state <a class="el" href="grpIntroStates.html#stPllOn">PLL_ON</a> is requested from the state <a class="el" href="grpIntroStates.html#stTrxOff">TRX_OFF</a>, the PLL needs up to <a class="el" href="pgConst.html#tTR4">tTR4</a> to lock to the channel (see also <a class="el" href="grpIrqPll.html#secphy_event_plllock">PHY_EVENT_PLL_LOCK</a>). The radio transceiver is only able to transmit frames after the <a class="el" href="group__apiHalPHY212Const.html#g3a84434fef569c52df0df298c308e624">TRX_IRQ_PLL_LOCK</a> occured.<p>
<div align="center">
<img src="inline_mscgraph_38.png" alt="inline_mscgraph_38" border="0" usemap="#inline_mscgraph_38.map">
<map name="inline_mscgraph_38.map"><area href="grpIntroStates.html#stTrxOff" shape="rect" coords="430,26,470,39" alt="">
<area href="pgConst.html#tTR4" shape="rect" coords="160,69,189,82" alt="">
<area href="grpIntroStates.html#stPllOn" shape="rect" coords="433,151,467,164" alt="">
</map>
</div>
 <dl class="user" compact><dt><b>Code example</b></dt><dd><div class="fragment"><pre class="fragment">    <span class="comment">/* AT86RF212::TRX_OFF */</span>
    <a class="code" href="group__apiHalFuncBasic.html#g4a22a30602ea72effde4450ce80a6480" title="Write a value to a subregister.">trx_bit_write</a>(<a class="code" href="group__apiHalPHY212Sreg.html#g8d912618842812f37fc46356eff73c93">SR_TRX_CMD</a>, <a class="code" href="group__apiHalPHY212Const.html#g86eb3f35dbb0833379e005d0a934ed95">CMD_PLL_ON</a>);
    delay(tTR4);
    <span class="comment">/* AT86RF212::PLL_ON */</span>
    trxstat = <a class="code" href="group__apiHalFuncBasic.html#ge7ea3d090b5d26b73a5c62e2e61e0231" title="Read a value from a subregister.">trx_bit_read</a>(<a class="code" href="group__apiHalPHY212Sreg.html#gbb9dcc6f85b1154d76645b5de64d4835">SR_TRX_STATUS</a>);
    ASSERT(trxstat==<a class="code" href="group__apiHalPHY212Const.html#g77a32ac338596fe95ea09d7603d7c295">PLL_ON</a>);
</pre></div></dd></dl>
<h2><a class="anchor" name="secplme_set_trx_state_txon_at_pll_active">
PHY_STATE_[PLL_ACTIVE]__PLL_ON</a></h2>
If the state <a class="el" href="grpIntroStates.html#stPllOn">PLL_ON</a> is requested from one of the <a class="el" href="grpIntroStates.html#stPllActive">[PLL_ACTIVE]</a> states, the transition occurs within <a class="el" href="pgConst.html#tTR9">tTR9</a>.<p>
<div align="center">
<img src="inline_mscgraph_39.png" alt="inline_mscgraph_39" border="0" usemap="#inline_mscgraph_39.map">
<map name="inline_mscgraph_39.map"><area href="grpIntroStates.html#stPllActive" shape="rect" coords="415,26,485,39" alt="">
<area href="pgConst.html#tTR9" shape="rect" coords="160,69,189,82" alt="">
<area href="grpIntroStates.html#stPllOn" shape="rect" coords="433,126,467,139" alt="">
</map>
</div>
 <dl class="user" compact><dt><b>Code example</b></dt><dd><div class="fragment"><pre class="fragment">    <span class="comment">/* AT86RF212::[PLL_ACTIVE] */</span>
    <a class="code" href="group__apiHalFuncBasic.html#g4a22a30602ea72effde4450ce80a6480" title="Write a value to a subregister.">trx_bit_write</a>(<a class="code" href="group__apiHalPHY212Sreg.html#g8d912618842812f37fc46356eff73c93">SR_TRX_CMD</a>, <a class="code" href="group__apiHalPHY212Const.html#g86eb3f35dbb0833379e005d0a934ed95">CMD_PLL_ON</a>);
    delay(tTR9);
    <span class="comment">/* AT86RF212::PLL_ON */</span>
    trxstat = <a class="code" href="group__apiHalFuncBasic.html#ge7ea3d090b5d26b73a5c62e2e61e0231" title="Read a value from a subregister.">trx_bit_read</a>(<a class="code" href="group__apiHalPHY212Sreg.html#gbb9dcc6f85b1154d76645b5de64d4835">SR_TRX_STATUS</a>);
    ASSERT(trxstat==<a class="code" href="group__apiHalPHY212Const.html#g77a32ac338596fe95ea09d7603d7c295">PLL_ON</a>);
</pre></div></dd></dl>
<h2><a class="anchor" name="secplme_set_trx_state_txon_at_busynotrxaack">
PHY_STATE_[BUSY]__PLL_ON</a></h2>
If the command <a class="el" href="group__apiHalPHY212Const.html#g86eb3f35dbb0833379e005d0a934ed95">CMD_PLL_ON</a> is written to the sub register <a class="el" href="group__apiHalPHY212Sreg.html#g8d912618842812f37fc46356eff73c93">SR_TRX_CMD</a> and the radio transceiver is in one of the <a class="el" href="grpIntroStates.html#stTrxBusy">[BUSY]</a> states, the ongoing transmit or receive transaction is completed and the state change to <a class="el" href="grpIntroStates.html#stPllOn">PLL_ON</a> occurs with the <a class="el" href="group__apiHalPHY212Const.html#ge34c1f5817526945d96c7cda6689f342">TRX_IRQ_TRX_END</a> interrupt.<p>
<dl class="note" compact><dt><b>Note:</b></dt><dd><br>
<small><b>&gt;&gt;</b></small>&nbsp; It is possible to cancel any ongoing transaction and force an immediate state change by using <a class="el" href="group__apiHalPHY212Const.html#g12eaacbac3b035bafe907c53dbce70dd">CMD_FORCE_PLL_ON</a> (see <a class="el" href="grpStateTxOn.html#secplme_force_pll_on_at_active">PHY_FORCE_[ACTIVE]__PLL_ON</a>). This might be especially useful in <a class="el" href="grpIntroStates.html#stTxAretBusy">BUSY_TX_ARET</a>, when long backoff times and many CSMA/frame retransmissions are configured. <br>
<small><b>&gt;&gt;</b></small>&nbsp; This use case is not valid for state <a class="el" href="grpIntroStates.html#stRxAackBusy">BUSY_RX_AACK</a>. For handling of this state refer to <a class="el" href="grpStateTxOn.html#secplme_set_trx_state_txon_at_busy">PHY_STATE_BUSY_RX_AACK__PLL_ON</a>.</dd></dl>
<div align="center">
<img src="inline_mscgraph_40.png" alt="inline_mscgraph_40" border="0" usemap="#inline_mscgraph_40.map">
<map name="inline_mscgraph_40.map"><area href="grpIntroStates.html#stTrxBusy" shape="rect" coords="433,26,467,39" alt="">
<area href="grpIntroStates.html#stPllOn" shape="rect" coords="433,126,467,139" alt="">
</map>
</div>
 <dl class="user" compact><dt><b>Code example</b></dt><dd><div class="fragment"><pre class="fragment">    <span class="comment">/* AT86RF212::[BUSY] */</span>
    <a class="code" href="group__apiHalFuncBasic.html#g4a22a30602ea72effde4450ce80a6480" title="Write a value to a subregister.">trx_bit_write</a>(<a class="code" href="group__apiHalPHY212Sreg.html#g8d912618842812f37fc46356eff73c93">SR_TRX_CMD</a>, <a class="code" href="group__apiHalPHY212Const.html#g86eb3f35dbb0833379e005d0a934ed95">CMD_PLL_ON</a>);
    <span class="comment">/* TRX_IRQ_TRX_END occurs here */</span>
    <span class="comment">/* AT86RF212::PLL_ON */</span>
    trxstat = <a class="code" href="group__apiHalFuncBasic.html#ge7ea3d090b5d26b73a5c62e2e61e0231" title="Read a value from a subregister.">trx_bit_read</a>(<a class="code" href="group__apiHalPHY212Sreg.html#gbb9dcc6f85b1154d76645b5de64d4835">SR_TRX_STATUS</a>);
    ASSERT(trxstat==<a class="code" href="group__apiHalPHY212Const.html#g77a32ac338596fe95ea09d7603d7c295">PLL_ON</a>);
</pre></div></dd></dl>
<h2><a class="anchor" name="secplme_set_trx_state_txon_at_busy">
PHY_STATE_BUSY_RX_AACK__PLL_ON</a></h2>
If the radio transceiver is in state <a class="el" href="grpIntroStates.html#stRxAackBusy">BUSY_RX_AACK</a>, an <a class="el" href="group__apiHalPHY212Const.html#ge34c1f5817526945d96c7cda6689f342">TRX_IRQ_TRX_END</a> occurs only, if the incoming frame matches the address filter and if the FCS is correct. If the acknowledgment request bit is set in the frame control field of the frame header and an <a class="el" href="group__apiHalPHY212Const.html#ge34c1f5817526945d96c7cda6689f342">TRX_IRQ_TRX_END</a> occurs, an automatically generated acknowledgement will be transmitted. Thus, the transceiver will stay in <a class="el" href="grpIntroStates.html#stRxAackBusy">BUSY_RX_AACK</a> for time <a class="el" href="pgConst.html#tPAck">tPAck</a> after <a class="el" href="group__apiHalPHY212Const.html#ge34c1f5817526945d96c7cda6689f342">TRX_IRQ_TRX_END</a>. Otherwise, it will return to <a class="el" href="grpIntroStates.html#stPllOn">PLL_ON</a> at latest after <a class="el" href="pgConst.html#tFrame">tFrame</a>.<p>
<dl class="note" compact><dt><b>Note:</b></dt><dd><br>
<small><b>&gt;&gt;</b></small>&nbsp; It is possible to read the acknowledgment request subfield of a frame after <a class="el" href="group__apiHalPHY212Const.html#ge34c1f5817526945d96c7cda6689f342">TRX_IRQ_TRX_END</a>. If this bit is not set, the radio transceiver will be in state <a class="el" href="grpIntroStates.html#stPllOn">PLL_ON</a> immediately after the <a class="el" href="group__apiHalPHY212Const.html#ge34c1f5817526945d96c7cda6689f342">TRX_IRQ_TRX_END</a>. <br>
<small><b>&gt;&gt;</b></small>&nbsp; To avoid long timeouts, it is possible to use command <a class="el" href="group__apiHalPHY212Const.html#g12eaacbac3b035bafe907c53dbce70dd">CMD_FORCE_PLL_ON</a> to initiate an immediate state change (see <a class="el" href="grpStateTxOn.html#secplme_force_pll_on_at_active">PHY_FORCE_[ACTIVE]__PLL_ON</a>).</dd></dl>
<div align="center">
<img src="inline_mscgraph_41.png" alt="inline_mscgraph_41" border="0" usemap="#inline_mscgraph_41.map">
<map name="inline_mscgraph_41.map"><area href="grpIntroStates.html#stRxAackBusy" shape="rect" coords="415,26,485,39" alt="">
<area href="pgConst.html#tFrame" shape="rect" coords="160,69,201,82" alt="">
<area href="pgConst.html#tPAck" shape="rect" coords="160,144,195,157" alt="">
<area href="grpIntroStates.html#stPllOn" shape="rect" coords="433,226,467,239" alt="">
</map>
</div>
 <dl class="user" compact><dt><b>Code example</b></dt><dd><div class="fragment"><pre class="fragment">    <span class="comment">/* AT86RF212::BUSY_RX_AACK */</span>
    <a class="code" href="group__apiHalFuncBasic.html#g4a22a30602ea72effde4450ce80a6480" title="Write a value to a subregister.">trx_bit_write</a>(<a class="code" href="group__apiHalPHY212Sreg.html#g8d912618842812f37fc46356eff73c93">SR_TRX_CMD</a>, <a class="code" href="group__apiHalPHY212Const.html#g86eb3f35dbb0833379e005d0a934ed95">CMD_PLL_ON</a>);
    delay(tFrame);
    <span class="comment">/* AT86RF212::PLL_ON */</span>
    trxstat = <a class="code" href="group__apiHalFuncBasic.html#ge7ea3d090b5d26b73a5c62e2e61e0231" title="Read a value from a subregister.">trx_bit_read</a>(<a class="code" href="group__apiHalPHY212Sreg.html#gbb9dcc6f85b1154d76645b5de64d4835">SR_TRX_STATUS</a>);
    ASSERT(trxstat==<a class="code" href="group__apiHalPHY212Const.html#g77a32ac338596fe95ea09d7603d7c295">PLL_ON</a>);
</pre></div></dd></dl>
<h2><a class="anchor" name="secplme_force_pll_on_at_active">
PHY_FORCE_[ACTIVE]__PLL_ON</a></h2>
Writing <a class="el" href="group__apiHalPHY212Const.html#g12eaacbac3b035bafe907c53dbce70dd">CMD_FORCE_PLL_ON</a> to sub register <a class="el" href="group__apiHalPHY212Sreg.html#g8d912618842812f37fc46356eff73c93">SR_TRX_CMD</a> in any of the <a class="el" href="grpIntroStates.html#stPllActive">[PLL_ACTIVE]</a> states cancels any ongoing transmit or receive transaction and switches the radio transceiver within <a class="el" href="pgConst.html#tTR14">tTR14</a> to state <a class="el" href="grpIntroStates.html#stPllOn">PLL_ON</a>.<p>
<dl class="note" compact><dt><b>Note:</b></dt><dd>The <a class="el" href="group__apiHalPHY212Const.html#g12eaacbac3b035bafe907c53dbce70dd">CMD_FORCE_PLL_ON</a> is not applicable in the states <em>SLEEP</em>, <em>{RX_ON,RX_AACK_ON,BUSY_RX_AACK}_NOCLK</em>, and during a <em><a class="el" href="group__apiHalPHY212Const.html#gf0c6d5f829c07fe27fac094daffbb2ab">STATE_TRANSITION_IN_PROGRESS</a></em> towards these states.<p>
The <a class="el" href="group__apiHalPHY212Const.html#g12eaacbac3b035bafe907c53dbce70dd">CMD_FORCE_PLL_ON</a> can be used also state <a class="el" href="grpIntroStates.html#stTrxOff">TRX_OFF</a>. In this case the transition time towards state <a class="el" href="grpIntroStates.html#stPllOn">PLL_ON</a> is <a class="el" href="pgConst.html#tTR4">tTR4</a> instead of <a class="el" href="pgConst.html#tTR14">tTR14</a>.</dd></dl>
<div align="center">
<img src="inline_mscgraph_42.png" alt="inline_mscgraph_42" border="0" usemap="#inline_mscgraph_42.map">
<map name="inline_mscgraph_42.map"><area href="grpIntroStates.html#stPllActive" shape="rect" coords="415,26,485,39" alt="">
<area href="pgConst.html#tTR14" shape="rect" coords="160,69,195,82" alt="">
<area href="grpIntroStates.html#stPllOn" shape="rect" coords="433,126,467,139" alt="">
</map>
</div>
 <dl class="user" compact><dt><b>Code example</b></dt><dd><div class="fragment"><pre class="fragment">    <span class="comment">/* AT86RF212::[PLL_ACTIVE] */</span>
    <a class="code" href="group__apiHalFuncBasic.html#g4a22a30602ea72effde4450ce80a6480" title="Write a value to a subregister.">trx_bit_write</a>(<a class="code" href="group__apiHalPHY212Sreg.html#g8d912618842812f37fc46356eff73c93">SR_TRX_CMD</a>, <a class="code" href="group__apiHalPHY212Const.html#g12eaacbac3b035bafe907c53dbce70dd">CMD_FORCE_PLL_ON</a>);
    delay(tTR14);
    <span class="comment">/* AT86RF212::PLL_ON */</span>
    trxstat = <a class="code" href="group__apiHalFuncBasic.html#ge7ea3d090b5d26b73a5c62e2e61e0231" title="Read a value from a subregister.">trx_bit_read</a>(<a class="code" href="group__apiHalPHY212Sreg.html#gbb9dcc6f85b1154d76645b5de64d4835">SR_TRX_STATUS</a>);
    ASSERT(trxstat==<a class="code" href="group__apiHalPHY212Const.html#g77a32ac338596fe95ea09d7603d7c295">PLL_ON</a>);
</pre></div> </dd></dl>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Aug 17 13:35:00 2009 for SWPM AT86RF212 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
