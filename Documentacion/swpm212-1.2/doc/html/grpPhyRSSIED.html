<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>SWPM AT86RF212: RSSI and ED Measurement</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="main.html">AT86RF212 Programming</a>&nbsp;&raquo&nbsp;<a class="el" href="pgSwpmAT86RF212.html">Software Programming Model</a>&nbsp;&raquo&nbsp;<a class="el" href="grpPhyCcaEdRssi.html">RSSI, ED, CCA Measurement, and RX Status Information</a>
  </div>
</div>
<div class="contents">
<h1><a class="anchor" name="grpPhyRSSIED">RSSI and ED Measurement </a></h1>This section describes how the RSSI measurement (Received Signal Strength Indication) and the ED measurement (Energy Detection) is done for the current RF channel.<p>
The 5-bit RSSI value has a valid range from {0 ... 28} and indicates the receive power in the selected RF channel, in steps of 3 dB. The value is updated in the radio transceiver every <a class="el" href="pgConst.html#tTR25">tTR25</a> and can be read from the sub register <a class="el" href="group__apiHalPHY212Sreg.html#ge4a0fbc6bd43fdcb0272429f5b6edb86">SR_RSSI</a>.<p>
The ED value is calculated by averaging the RSSI values over 8 symbol periods, i.e. the measurement duration results to <code>8*<a class="el" href="pgConst.html#tsym">tsym</a></code>. Due to the internal processing in the radio transceiver, an ED measurement is finished after <a class="el" href="pgConst.html#tTR26">tTR26</a>.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>rssi</em>&nbsp;</td><td>The current RF input power is calculated by:<ul>
<li>{0}: <code>P<sub>RF</sub> &lt; <a class="el" href="pgConst.html#secConstRSSI">RSSI_BASE_VAL</a> [dBm]</code></li><li>{1...27}: <code>P<sub>RF</sub> = <a class="el" href="pgConst.html#secConstRSSI">RSSI_BASE_VAL</a> + 3 * (PHY_RSSI - 1) [dBm]</code></li><li>{28}: <code>P<sub>RF</sub>&gt;= <a class="el" href="pgConst.html#secConstRSSI">RSSI_BASE_VAL</a> + 81 [dBm]</code> </li></ul>
</td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ed</em>&nbsp;</td><td>The 8 bit ED value can be read from register <a class="el" href="group__apiHalPHY212Reg.html#g4caa8e52e3f9ad2217864df65fdfd501">RG_PHY_ED_LEVEL</a>. It has a valid range from <code>ed</code> = {0,...,84}, the reset value is {255} and the values {85,...,254} are reserved. The RF signal power level for a measurement period is <code><a class="el" href="pgConst.html#secConstRSSI">RSSI_BASE_VAL</a> + ed [dBm]</code>. The value <code>ed=0</code> means, that the calculated energy is <code>energy&lt;=<a class="el" href="pgConst.html#secConstRSSI">RSSI_BASE_VAL</a> [dBm]</code>.</td></tr>
  </table>
</dl>
<dl class="note" compact><dt><b>Note:</b></dt><dd>If the signal strength of an incoming frame has to be evaluated it is recommended to use the ED value (see <a class="el" href="grpPhyRSSIED.html#secphy_ed_frame_end">PHY_ED_FRAME_END</a>) instead of the RSSI value, because the ED value is more reliable since it obtains less variance caused by noise.<p>
The ED value is also part of the RX status information appended to each frame (see <a class="el" href="grpPhyFrameInfo.html">RX Frame Status Information</a>).</dd></dl>
<b>Use Cases:</b><ul>
<li><a class="el" href="grpPhyRSSIED.html#secphy_rssi_request">PHY_GET_RSSI</a></li><li><a class="el" href="grpPhyRSSIED.html#secphy_ed_request">PHY_ED_REQUEST</a></li><li><a class="el" href="grpPhyRSSIED.html#secphy_ed_frame_end">PHY_ED_FRAME_END</a></li></ul>
<p>
<hr>
<h2><a class="anchor" name="secphy_rssi_request">
PHY_GET_RSSI</a></h2>
The RSSI value can be retrieved from the sub register <a class="el" href="group__apiHalPHY212Sreg.html#ge4a0fbc6bd43fdcb0272429f5b6edb86">SR_RSSI</a> whenever the radio transceiver is in one of the <a class="el" href="grpIntroStates.html#stTrxRxBasic">[RX_BASIC]</a> states.<p>
<dl class="note" compact><dt><b>Note:</b></dt><dd>It is also possible to read <a class="el" href="group__apiHalPHY212Sreg.html#ge4a0fbc6bd43fdcb0272429f5b6edb86">SR_RSSI</a> in <a class="el" href="grpIntroStates.html#stRxAackOn">RX_AACK_ON</a>. However, the value should not be read in <a class="el" href="grpIntroStates.html#stRxAackBusy">BUSY_RX_AACK</a>.</dd></dl>
<div align="center">
<img src="inline_mscgraph_69.png" alt="inline_mscgraph_69" border="0" usemap="#inline_mscgraph_69.map">
<map name="inline_mscgraph_69.map"><area href="grpIntroStates.html#stTrxRxBasic" shape="rect" coords="421,26,479,39" alt="">
</map>
</div>
 <dl class="user" compact><dt><b>Code example</b></dt><dd><div class="fragment"><pre class="fragment">    <span class="comment">/* AT86RF212::[RX_BASIC] */</span>
    rssi = <a class="code" href="group__apiHalFuncBasic.html#ge7ea3d090b5d26b73a5c62e2e61e0231" title="Read a value from a subregister.">trx_bit_read</a>(<a class="code" href="group__apiHalPHY212Sreg.html#ge4a0fbc6bd43fdcb0272429f5b6edb86">SR_RSSI</a>);
</pre></div></dd></dl>
<h2><a class="anchor" name="secphy_ed_request">
PHY_ED_REQUEST</a></h2>
An ED measurement can be started by writing an arbitrary value to the register <a class="el" href="group__apiHalPHY212Reg.html#g4caa8e52e3f9ad2217864df65fdfd501">RG_PHY_ED_LEVEL</a>. After <a class="el" href="pgConst.html#tTR26">tTR26</a> the <a class="el" href="group__apiHalPHY212Const.html#g4dc830446c62bea8ebfa172b61677776">TRX_IRQ_CCA_ED_DONE</a> indicates the completion of the ED measurement procedure and the ED value can be read from this register.<p>
<div align="center">
<img src="inline_mscgraph_70.png" alt="inline_mscgraph_70" border="0" usemap="#inline_mscgraph_70.map">
<map name="inline_mscgraph_70.map"><area href="grpIntroStates.html#stTrxRxBasic" shape="rect" coords="421,26,479,39" alt="">
<area href="pgConst.html#tED" shape="rect" coords="160,94,183,107" alt="">
</map>
</div>
 <dl class="user" compact><dt><b>Code example</b></dt><dd><div class="fragment"><pre class="fragment">    <span class="comment">/* AT86RF212::[RX_BASIC] */</span>
    <a class="code" href="group__apiHalFuncBasic.html#g63cd512542173c0a69f2ead0890defed" title="Write a value to a register.">trx_reg_write</a>(<a class="code" href="group__apiHalPHY212Reg.html#g4caa8e52e3f9ad2217864df65fdfd501">RG_PHY_ED_LEVEL</a>, 0);
    delay(tED);
    ed = <a class="code" href="group__apiHalFuncBasic.html#gd31a9a2f63e52d485d975d59f7c1d5f4" title="Read the value from a register.">trx_reg_read</a>(<a class="code" href="group__apiHalPHY212Reg.html#g4caa8e52e3f9ad2217864df65fdfd501">RG_PHY_ED_LEVEL</a>);
</pre></div></dd></dl>
<h2><a class="anchor" name="secphy_ed_frame_end">
PHY_ED_FRAME_END</a></h2>
With the detection of a SFD an ED measurement is automatically started. The result of this ED measurement is valid within a time interval which starts <a class="el" href="pgConst.html#tReadED">tReadED</a> after the interrupt <a class="el" href="group__apiHalPHY212Const.html#gab5ff5ca963c7556f4f1e0e37f045604">TRX_IRQ_RX_START</a> and ends <a class="el" href="pgConst.html#tHED">tHED</a> after the interrupt <a class="el" href="group__apiHalPHY212Const.html#ge34c1f5817526945d96c7cda6689f342">TRX_IRQ_TRX_END</a>. During this period, the register <a class="el" href="group__apiHalPHY212Reg.html#g4caa8e52e3f9ad2217864df65fdfd501">RG_PHY_ED_LEVEL</a> yields the ED value for the currently received frame.<p>
<dl class="note" compact><dt><b>Note:</b></dt><dd><ul>
<li>If the transceiver is in the <a class="el" href="grpRf212AutoRx.html">RX_AACK</a> mode, the register <a class="el" href="group__apiHalPHY212Reg.html#g4caa8e52e3f9ad2217864df65fdfd501">RG_PHY_ED_LEVEL</a> can be read immediately after interrupt <a class="el" href="group__apiHalPHY212Const.html#gf6899ef98af446c018af6fa8d9f414dc">TRX_IRQ_AMI</a> or <a class="el" href="pgConst.html#tReadED">tReadED</a> after the interrupt <a class="el" href="group__apiHalPHY212Const.html#gab5ff5ca963c7556f4f1e0e37f045604">TRX_IRQ_RX_START</a>.</li><li>The ED level is automatically appended during a frame read access as described in section <a class="el" href="grpPhyRx.html">Frame Receive Procedure (RX)</a>. In this case no separate register access is needed.</li></ul>
</dd></dl>
<div align="center">
<img src="inline_mscgraph_71.png" alt="inline_mscgraph_71" border="0" usemap="#inline_mscgraph_71.map">
<map name="inline_mscgraph_71.map"><area href="grpIntroStates.html#stRxActive" shape="rect" coords="418,26,482,39" alt="">
<area href="pgConst.html#tPSDU" shape="rect" coords="160,94,195,107" alt="">
<area href="pgConst.html#tHED" shape="rect" coords="160,169,189,182" alt="">
</map>
</div>
 <dl class="user" compact><dt><b>Code example</b></dt><dd><div class="fragment"><pre class="fragment">    <span class="comment">/* AT86RF212::[RX_ACTIVE] */</span>
    delay(tPSDU);
    ed = <a class="code" href="group__apiHalFuncBasic.html#gd31a9a2f63e52d485d975d59f7c1d5f4" title="Read the value from a register.">trx_reg_read</a>(<a class="code" href="group__apiHalPHY212Reg.html#g4caa8e52e3f9ad2217864df65fdfd501">RG_PHY_ED_LEVEL</a>);
</pre></div> </dd></dl>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Aug 17 13:35:00 2009 for SWPM AT86RF212 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
