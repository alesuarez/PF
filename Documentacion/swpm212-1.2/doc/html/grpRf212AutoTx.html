<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>SWPM AT86RF212: Extended Frame Transmit Procedure (TX_ARET)</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="main.html">AT86RF212 Programming</a>&nbsp;&raquo&nbsp;<a class="el" href="pgSwpmAT86RF212.html">Software Programming Model</a>&nbsp;&raquo&nbsp;<a class="el" href="grpRf212Auto.html">Extended Operating Mode</a>
  </div>
</div>
<div class="contents">
<h1><a class="anchor" name="grpRf212AutoTx">Extended Frame Transmit Procedure (TX_ARET) </a></h1>This section describes configuration and frame transmission in TX_ARET mode.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>txcrc</em>&nbsp;</td><td>If set to 1, the CRC is calculated automatically, otherwise, the frame will be transmitted as it was downloaded. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>frame_retr</em>&nbsp;</td><td>Number of attempts until giving up sending a frame sucessfully. The parameter has the range 0 ... 15, with the following meaning:<ul>
<li>0 : 1 transmit attempt in total,</li><li>1 : 2 transmit attempts (1 retry), ...,</li><li>15 : 16 transmit attempts (15 retries). </li></ul>
</td></tr>
    <tr><td valign="top"></td><td valign="top"><em>lbt</em>&nbsp;</td><td>Flag which determines, that LBT method should be used instead of CSMA. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>csma_retr</em>&nbsp;</td><td>Number of maximum CSMA attempts before giving up sending a frame. The parameter has the range {0...7} with the following meaning:<ul>
<li>0 : 1 CSMA attempt,</li><li>1 : 2 CSMA attempts (1 retry), ...,</li><li>6 : 7 CSMA attempts (6 retries),</li><li>7 : <em>no</em> CSMA attempt. </li></ul>
</td></tr>
    <tr><td valign="top"></td><td valign="top"><em>csma_seed</em>&nbsp;</td><td>The seed value for the random number generator of the CSMA-CA algorithm. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>min_be</em>&nbsp;</td><td>Value of the minimum backoff exponent in the CSMA-CA algorithm. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>max_be</em>&nbsp;</td><td>Value of the maximum backoff exponent in the CSMA-CA algorithm.</td></tr>
  </table>
</dl>
For CSMA and LBT the parameters <a class="el" href="grpPhyCCA.html#ccaParMode">mode</a> and <a class="el" href="grpPhyCCA.html#ccaParEdthrs">edthrs</a> are configured according to section <a class="el" href="grpPhyCCA.html">CCA Measurement</a>.<p>
<dl class="user" compact><dt><b>Differences between CSMA and LBT</b></dt><dd></dd></dl>
In CSMA mode the radio transceiver attempts at maximum <code>csma_retr</code> channel assessments before sending a frame or giving up. In LBT mode the number of CSMA attempts is inifinite and therefore the parameters <code>csma_retr</code>, <code>csma_seed</code>, <code>min_be</code>, and <code>max_be</code> are ignored. In the case of a permanently blocked channel, the CSMA mode terminates with a <a class="el" href="group__apiHalPHY212Const.html#ge34c1f5817526945d96c7cda6689f342">TRX_IRQ_TRX_END</a> interrupt and the result <a class="el" href="group__apiHalPHY212Const.html#g30ac3e3fa9ccbf2d66787dc2b11d7569">TRAC_CHANNEL_ACCESS_FAILURE</a> in the sub register <a class="el" href="group__apiHalPHY212Sreg.html#g4692d9ea2770ff145d1c35c513cbf1d6">SR_TRAC_STATUS</a>. Under the same conditions, the LBT mode never terminates with any interrupt, continuously trying to detect that the channel is idle.<p>
<dl class="note" compact><dt><b>Note:</b></dt><dd><ul>
<li>The IEEE 802.15.4-2003 standard defines the maximum number of retransmissions as three, whereas the IEEE 802.15.4-2006 standards allows up to 7 retransmissions.</li></ul>
</dd></dl>
<b>Use Cases:</b><ul>
<li><a class="el" href="grpRf212AutoTx.html#secphy_set_autotx_config_aret">PHY_CONFIG_TX_ARET</a></li><li><a class="el" href="grpRf212AutoTx.html#secphy_set_csma_seed">PHY_SET_CSMA_SEED</a></li><li><a class="el" href="grpRf212AutoTx.html#secphy_data_request_autotx_aret">PHY_DATA_REQUEST_TX_ARET</a></li><li><a class="el" href="grpPhyCCA.html#secphy_set_ccamode">PHY_SET_CCA_CFG</a></li></ul>
<p>
<hr>
<h2><a class="anchor" name="secphy_set_autotx_config_aret">
PHY_CONFIG_TX_ARET</a></h2>
This sequence describes how the TX_ARET mode parameters are configured.<p>
<div align="center">
<img src="inline_mscgraph_82.png" alt="inline_mscgraph_82" border="0" usemap="#inline_mscgraph_82.map">
<map name="inline_mscgraph_82.map"><area href="grpIntroStates.html#stTrxConfig" shape="rect" coords="427,26,473,39" alt="">
</map>
</div>
 <dl class="user" compact><dt><b>Code example</b></dt><dd><div class="fragment"><pre class="fragment">    <span class="comment">/* AT86RF212::[CONFIG] */</span>
    <a class="code" href="group__apiHalFuncBasic.html#g4a22a30602ea72effde4450ce80a6480" title="Write a value to a subregister.">trx_bit_write</a>(<a class="code" href="group__apiHalPHY212Sreg.html#g53420a51ab0ad2e5b108d5cbbdf6f3b6">SR_TX_AUTO_CRC_ON</a>, txcrc);
    <a class="code" href="group__apiHalFuncBasic.html#g4a22a30602ea72effde4450ce80a6480" title="Write a value to a subregister.">trx_bit_write</a>(<a class="code" href="group__apiHalPHY212Sreg.html#g1c29b8561f46d5949033e45c4a0ddcd1">SR_MAX_FRAME_RETRIES</a>, frame_rctr);
    <a class="code" href="group__apiHalFuncBasic.html#g4a22a30602ea72effde4450ce80a6480" title="Write a value to a subregister.">trx_bit_write</a>(<a class="code" href="group__apiHalPHY212Sreg.html#g604da551bed3d6f2ba5075cbdb2fce97">SR_CSMA_LBT_MODE</a>, lbt);
    <a class="code" href="group__apiHalFuncBasic.html#g4a22a30602ea72effde4450ce80a6480" title="Write a value to a subregister.">trx_bit_write</a>(<a class="code" href="group__apiHalPHY212Sreg.html#g90d23d615a36396e2d4ce50fc1126a60">SR_MAX_CSMA_RETRIES</a>, csma_rctr);
    <a class="code" href="group__apiHalFuncBasic.html#g4a22a30602ea72effde4450ce80a6480" title="Write a value to a subregister.">trx_bit_write</a>(<a class="code" href="group__apiHalPHY212Sreg.html#g5c34ba9a75fedbe5c8366f6631f183ae">SR_MIN_BE</a>, min_be);
    <a class="code" href="group__apiHalFuncBasic.html#g4a22a30602ea72effde4450ce80a6480" title="Write a value to a subregister.">trx_bit_write</a>(<a class="code" href="group__apiHalPHY212Sreg.html#g5277388c0cde68974b16c6bda2fb3f35">SR_MAX_BE</a>, max_be);
</pre></div></dd></dl>
<h2><a class="anchor" name="secphy_set_csma_seed">
PHY_SET_CSMA_SEED</a></h2>
The content of registers <a class="el" href="group__apiHalPHY212Reg.html#g0be03a19a6b1cf46a550cd0a5dc1b55b">RG_CSMA_SEED_0</a> and <a class="el" href="group__apiHalPHY212Reg.html#gd13c7575f9673b164a24725b3046afd3">RG_CSMA_SEED_1</a> initializes the TX_ARET random backoff generator after the wakeup from <a class="el" href="grpIntroStates.html#stSleep">SLEEP</a> state. To prevent a reinitialization with the same value it is recommended to reinitialize both registers before every <a class="el" href="grpIntroStates.html#stSleep">SLEEP</a> state with a random value.<p>
The following use case illustrates the initialisation of the CSMA seed with a wake-sleep-wake sequence (see also <a class="el" href="grpStateSleep.html">Transitions to/from State SLEEP</a>).<p>
The splitting of the parameters into register values is described in section <a class="el" href="grpIntroTransceiverAccess.html#pgMultiByte">Handling of Multibyte Variables</a>.<p>
<div align="center">
<img src="inline_mscgraph_83.png" alt="inline_mscgraph_83" border="0" usemap="#inline_mscgraph_83.map">
<map name="inline_mscgraph_83.map"><area href="grpIntroStates.html#stTrxOff" shape="rect" coords="430,26,470,39" alt="">
<area href="pgConst.html#tTR3" shape="rect" coords="160,119,189,132" alt="">
<area href="grpIntroStates.html#stSleep" shape="rect" coords="436,176,464,189" alt="">
<area href="pgConst.html#tTR2" shape="rect" coords="160,219,189,232" alt="">
<area href="grpIntroStates.html#stTrxOff" shape="rect" coords="430,276,470,289" alt="">
</map>
</div>
 <dl class="user" compact><dt><b>Code example</b></dt><dd><div class="fragment"><pre class="fragment">    <span class="comment">/* AT86RF212::TRX_OFF */</span>
    <a class="code" href="group__apiHalFuncBasic.html#g4a22a30602ea72effde4450ce80a6480" title="Write a value to a subregister.">trx_bit_write</a>(<a class="code" href="group__apiHalPHY212Sreg.html#g241aa49cdb91c3abad40cc050e10b144">SR_CSMA_SEED_1</a>, csma_seed_10_8);
    <a class="code" href="group__apiHalFuncBasic.html#g63cd512542173c0a69f2ead0890defed" title="Write a value to a register.">trx_reg_write</a>(<a class="code" href="group__apiHalPHY212Reg.html#g0be03a19a6b1cf46a550cd0a5dc1b55b">RG_CSMA_SEED_0</a>, csma_seed_7_0);
    <a class="code" href="group__apiHalFuncBasic.html#g7ffbe4411fb6d28f884fd3da4c206893" title="Set the level of the SLP_TR pin.">trx_pinset_slptr</a>(1);
    delay(tTR3);
    <span class="comment">/* AT86RF212::SLEEP */</span>
    <a class="code" href="group__apiHalFuncBasic.html#g7ffbe4411fb6d28f884fd3da4c206893" title="Set the level of the SLP_TR pin.">trx_pinset_slptr</a>(0);
    delay(tTR2);
    <span class="comment">/* AT86RF212::TRX_OFF */</span>
</pre></div></dd></dl>
<h2><a class="anchor" name="secphy_data_request_autotx_aret">
PHY_DATA_REQUEST_TX_ARET</a></h2>
The frame transmission in TX_ARET mode combines a hardware assisted CSMA-CA followed by the frame transmission itself and the acknowledgement frame checking. Therefore the radio transceiver switches internally between transmit and receive states.<p>
The result of a TX_ARET transaction is stored in the sub register <a class="el" href="group__apiHalPHY212Sreg.html#g4692d9ea2770ff145d1c35c513cbf1d6">SR_TRAC_STATUS</a> after the <a class="el" href="group__apiHalPHY212Const.html#ge34c1f5817526945d96c7cda6689f342">TRX_IRQ_TRX_END</a> interrupt.<p>
<dl compact><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>tracstat</em>&nbsp;</td><td>Result of a TX_ARET transaction from sub register <a class="el" href="group__apiHalPHY212Sreg.html#g4692d9ea2770ff145d1c35c513cbf1d6">SR_TRAC_STATUS</a>.<ul>
<li><a class="el" href="group__apiHalPHY212Const.html#g055049d569c7e50ecb31baa46ab3d6c1">TRAC_SUCCESS</a> : The frame transmission was successful and an optional requested acknowledgement frame was received correct.</li><li><a class="el" href="group__apiHalPHY212Const.html#g8c7cfe21d16804261d01a04f045fc438">TRAC_SUCCESS_DATA_PENDING</a> : The frame transmission was successful and the frame pending subfield was set in the received ACK frame.</li><li><a class="el" href="group__apiHalPHY212Const.html#g30ac3e3fa9ccbf2d66787dc2b11d7569">TRAC_CHANNEL_ACCESS_FAILURE</a> : The CSMA-CA algorithm has failed and the frame could not be send.</li><li><a class="el" href="group__apiHalPHY212Const.html#g6af36c9e4e33766910c169eb60c8c011">TRAC_NO_ACK</a> : A correct ACK frame was not received within the required period of time.</li><li><a class="el" href="group__apiHalPHY212Const.html#gd43f24dc2040e71f091bdc2377aa063b">TRAC_INVALID</a> : The transaction is ongoing or was aborted.</li></ul>
</td></tr>
  </table>
</dl>
According to IEEE 802.15.4 an ACK frame needs to be received within an interval of 54 symbols for OQPSK modulation or 120 symbols for BPSK modulation. The internal timing for the ACK frame processing in TX_ARET mode is shown below:<p>
<pre></pre><p>
<pre> = CCA =:=== TX ===:============== RX ====================
                   0             72  80  88  96 104 112 120 [BPSK]
                   0             42  44  46  48  50  52  54 [O-QPSK]
        |~~~~~~+---|          |---+---+---+---+---+---+---|          time [symbols]
 -------|      | F |----------|SFD|PHR|    ACK    |  FCS  |-------------------------&gt;
        |~~~~~~+---|          |---o---+---+---+---+---+---|
        |          |              |                       |
        t0         t1             t2                      t3</pre><p>
<pre>         F = last transmitted byte,
         SFD, PHR, ACK, FCS = data of the received ACK frame</pre><p>
<pre> </pre><p>
<ul>
<li>t0 : If all CCA attempts fail a <a class="el" href="group__apiHalPHY212Const.html#ge34c1f5817526945d96c7cda6689f342">TRX_IRQ_TRX_END</a> interrupt is generated with tracstat=<a class="el" href="group__apiHalPHY212Const.html#g30ac3e3fa9ccbf2d66787dc2b11d7569">TRAC_CHANNEL_ACCESS_FAILURE</a>.</li><li>t1 : End of the frame transmission.</li><li>t2 : A <a class="el" href="group__apiHalPHY212Const.html#ge34c1f5817526945d96c7cda6689f342">TRX_IRQ_TRX_END</a> interrupt is generated with tracstat=<a class="el" href="group__apiHalPHY212Const.html#g6af36c9e4e33766910c169eb60c8c011">TRAC_NO_ACK</a>, if no SFD occurs.</li><li>t3 : For a successful TX_ARET transaction, the <a class="el" href="group__apiHalPHY212Const.html#ge34c1f5817526945d96c7cda6689f342">TRX_IRQ_TRX_END</a> interrupt is generated at this point in time (tracstat=<a class="el" href="group__apiHalPHY212Const.html#g055049d569c7e50ecb31baa46ab3d6c1">TRAC_SUCCESS</a> if ACK frame was valid); tracstat=<a class="el" href="group__apiHalPHY212Const.html#g8c7cfe21d16804261d01a04f045fc438">TRAC_SUCCESS_DATA_PENDING</a> if ACK was valid and frame pending bit was set in the ACK frame.</li></ul>
<p>
<dl class="note" compact><dt><b>Note:</b></dt><dd>After a TX_ARET transaction the frame is kept in the frame buffer, so that it can be sent out again. The received ACK frame is processed internally and therefore it is not stored in the frame buffer.</dd></dl>
<div align="center">
<img src="inline_mscgraph_84.png" alt="inline_mscgraph_84" border="0" usemap="#inline_mscgraph_84.map">
<map name="inline_mscgraph_84.map"><area href="grpIntroStates.html#stTxAretOn" shape="rect" coords="421,26,479,39" alt="">
<area href="pgConst.html#tTR10" shape="rect" coords="460,69,495,82" alt="">
<area href="pgConst.html#t7" shape="rect" coords="160,94,177,107" alt="">
<area href="grpIntroStates.html#stTxAretBusy" shape="rect" coords="415,176,485,189" alt="">
<area href="pgConst.html#tSHR" shape="rect" coords="160,219,189,232" alt="">
<area href="grpIntroStates.html#stTxAretOn" shape="rect" coords="421,426,479,439" alt="">
</map>
</div>
 <dl class="user" compact><dt><b>Code example</b></dt><dd><div class="fragment"><pre class="fragment">    <span class="comment">/* AT86RF212::TX_ARET_ON */</span>
    <a class="code" href="group__apiHalFuncBasic.html#g7ffbe4411fb6d28f884fd3da4c206893" title="Set the level of the SLP_TR pin.">trx_pinset_slptr</a>(1);
    delay(t7);
    <span class="comment">/* AT86RF212::BUSY_TX_ARET */</span>
    <a class="code" href="group__apiHalFuncBasic.html#g7ffbe4411fb6d28f884fd3da4c206893" title="Set the level of the SLP_TR pin.">trx_pinset_slptr</a>(0);
    <a class="code" href="group__apiHalFuncBasic.html#g9191fea0f277cb46af5ad28b67a6356d" title="Write a frame to the radio transceiver.">trx_frame_write</a>(len(frame), frame);
    <span class="comment">/* TRX_IRQ_TRX_END occurs here */</span>
    <span class="comment">/* AT86RF212::TX_ARET_ON */</span>
    tracstat = <a class="code" href="group__apiHalFuncBasic.html#ge7ea3d090b5d26b73a5c62e2e61e0231" title="Read a value from a subregister.">trx_bit_read</a>(<a class="code" href="group__apiHalPHY212Sreg.html#g4692d9ea2770ff145d1c35c513cbf1d6">SR_TRAC_STATUS</a>);
</pre></div> </dd></dl>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Aug 17 13:35:01 2009 for SWPM AT86RF212 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
