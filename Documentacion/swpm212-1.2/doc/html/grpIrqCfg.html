<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>SWPM AT86RF212: Interrupt Configuration and Handling</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="main.html">AT86RF212 Programming</a>&nbsp;&raquo&nbsp;<a class="el" href="pgSwpmAT86RF212.html">Software Programming Model</a>&nbsp;&raquo&nbsp;<a class="el" href="grpHandleIrq.html">Interrupts</a>
  </div>
</div>
<div class="contents">
<h1><a class="anchor" name="grpIrqCfg">Interrupt Configuration and Handling </a></h1>The interrupt signal on pin <a class="el" href="grpIntroMCU.html#wirePinIrq">TRX_PIN_IRQ</a> can be configured regarding to the masking of interrupt causes (see <a class="el" href="grpIrqCfg.html#secphy_irq_cfg">IRQ Mask Configuration</a>) and to the signal polarity (see <a class="el" href="grpIrqCfg.html#secirq_polarity">IRQ Polarity Configuration</a>). A more detailed description can also be found <a class="el" href="pgRef.html#refDataSheet">section 4.7</a> <em>(Interrupt Logic)</em> of the AT86RF212 datasheet. The configuration of <a class="el" href="grpIntroMCU.html#wirePinDIG2">TRX_PIN_DIG2</a> is described in section <a class="el" href="grpRxtime.html">RX Frame Time Stamping</a>.<p>
<b>Use Cases:</b><ul>
<li><a class="el" href="grpIrqCfg.html#secphy_irq_cfg">IRQ Mask Configuration</a></li><li><a class="el" href="grpIrqCfg.html#secirq_polarity">IRQ Polarity Configuration</a></li><li><a class="el" href="grpIrqCfg.html#secphy_irq">IRQ Handling</a></li></ul>
<p>
<hr>
<h2><a class="anchor" name="secphy_irq_cfg">
IRQ Mask Configuration</a></h2>
The value of the register <a class="el" href="group__apiHalPHY212Reg.html#g905b648376932649f2af990f20a03df6">RG_IRQ_MASK</a> determines, which of the <a class="el" href="grpHandleIrq.html#knownirqs">interrupt causes</a> generate interrupt requests at <a class="el" href="grpIntroMCU.html#wirePinIrq">TRX_PIN_IRQ</a>. Additionally, the generation of interrupt events can be controlled with the subregister <a class="el" href="group__apiHalPHY212Sreg.html#g0b612a879da54e0353cc43dbaf79de05">SR_IRQ_MASK_MODE</a>.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>mskirqs</em>&nbsp;</td><td>The mask value, which is written to <a class="el" href="group__apiHalPHY212Reg.html#g905b648376932649f2af990f20a03df6">RG_IRQ_MASK</a>. An IRQ is signalled on <a class="el" href="grpIntroMCU.html#wirePinIrq">TRX_PIN_IRQ</a>, if the apropriate bit in this register is set to 1. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>mskmode</em>&nbsp;</td><td>IRQ mask mode.<br>
 {0} : Only IRQs are enabled by <em>mskirqs</em> will be shown in <a class="el" href="group__apiHalPHY212Reg.html#g7dec4b1e3d3bfd3e9f6c243abc4f008e">RG_IRQ_STATUS</a>.<br>
 {1} : All IRQs will be shown in <a class="el" href="group__apiHalPHY212Reg.html#g7dec4b1e3d3bfd3e9f6c243abc4f008e">RG_IRQ_STATUS</a>.</td></tr>
  </table>
</dl>
<h3><a class="anchor" name="secIntBeh">
Interrupt Behaviour for combinations of mskirqs and mskmode</a></h3>
<table border="1" cellspacing="3" cellpadding="3">
<tr>
<th><em>mskirqs</em> </th><th><em>mskmode</em> </th><th>Description  </th></tr>
<tr>
<td align="center">0 </td><td align="center">0 </td><td>IRQ is suppressed entirely and none of <a class="el" href="grpHandleIrq.html#knownirqs">interrupt causes</a> is shown in <a class="el" href="group__apiHalPHY212Reg.html#g7dec4b1e3d3bfd3e9f6c243abc4f008e">RG_IRQ_STATUS</a>  </td></tr>
<tr>
<td align="center">0 </td><td align="center">1 </td><td>IRQ is suppressed entirely but all <a class="el" href="grpHandleIrq.html#knownirqs">interrupt causes</a> are shown in <a class="el" href="group__apiHalPHY212Reg.html#g7dec4b1e3d3bfd3e9f6c243abc4f008e">RG_IRQ_STATUS</a>  </td></tr>
<tr>
<td align="center"><a class="el" href="grpHandleIrq.html#knownirqs">[IC]</a> </td><td align="center">0 </td><td>All by <a class="el" href="grpHandleIrq.html#knownirqs">[IC]</a> enabled IRQs are signalled on <a class="el" href="grpIntroMCU.html#wirePinIrq">TRX_PIN_IRQ</a> and are also shown in <a class="el" href="group__apiHalPHY212Reg.html#g7dec4b1e3d3bfd3e9f6c243abc4f008e">RG_IRQ_STATUS</a>  </td></tr>
<tr>
<td align="center"><a class="el" href="grpHandleIrq.html#knownirqs">[IC]</a> </td><td align="center">1 </td><td>All by <a class="el" href="grpHandleIrq.html#knownirqs">[IC]</a> enabled IRQs are signalled on <a class="el" href="grpIntroMCU.html#wirePinIrq">TRX_PIN_IRQ</a> and all IRQ causes are shown in <a class="el" href="group__apiHalPHY212Reg.html#g7dec4b1e3d3bfd3e9f6c243abc4f008e">RG_IRQ_STATUS</a>  </td></tr>
</table>
<p>
<dl class="note" compact><dt><b>Note:</b></dt><dd><br>
<small><b>&gt;&gt;</b></small>&nbsp; The registers <a class="el" href="group__apiHalPHY212Reg.html#g905b648376932649f2af990f20a03df6">RG_IRQ_MASK</a> and <a class="el" href="group__apiHalPHY212Sreg.html#g0b612a879da54e0353cc43dbaf79de05">SR_IRQ_MASK_MODE</a> should not be changed in any of the <a class="el" href="grpIntroStates.html#stTrxBusy">[BUSY]</a> states. <br>
<small><b>&gt;&gt;</b></small>&nbsp; The register <a class="el" href="group__apiHalPHY212Reg.html#g905b648376932649f2af990f20a03df6">RG_IRQ_MASK</a> and can set in <a class="el" href="grpIntroStates.html#stPOn">P_ON</a> as described in <a class="el" href="grpPhyReset.html#secpower_on_reset">POWER_ON_RESET</a>. <br>
<small><b>&gt;&gt;</b></small>&nbsp; The pin <a class="el" href="grpIntroMCU.html#wirePinIrq">TRX_PIN_IRQ</a> can be alternatively used as <a class="el" href="grpBEmpty.html">Frame Buffer Empty Indicator</a>. The functionality of the IRQ pin can be configured using <a class="el" href="group__apiHalPHY212Sreg.html#gc12b3b668a97a79b1db88721c502804e">SR_RX_BL_CTRL</a>. <br>
<small><b>&gt;&gt;</b></small>&nbsp; The current IRQ status can also be monitored with the <a class="el" href="grpRf212SPICmd.html">SPI Command Mode</a>.</dd></dl>
<h3><a class="anchor" name="secExBoMo">
Example: Using SR_IRQ_MASK_MODE=1 for address match detection in Basic Operating Mode</a></h3>
It is assumed, that the radio transceiver is in the state <a class="el" href="grpIntroStates.html#stRxBusy">BUSY_RX</a> and the registers have the following values: <a class="el" href="group__apiHalPHY212Reg.html#g905b648376932649f2af990f20a03df6">RG_IRQ_MASK</a> = TRX_IRQ_TRX_END, <a class="el" href="group__apiHalPHY212Sreg.html#g0b612a879da54e0353cc43dbaf79de05">SR_IRQ_MASK_MODE</a> = 1. At the end of a received frame, the interrupt <a class="el" href="group__apiHalPHY212Const.html#ge34c1f5817526945d96c7cda6689f342">TRX_IRQ_TRX_END</a> is generated. If the address of the received frame matches the settings in the address registers (see section <a class="el" href="grpRf212CfgAutoRx.html">Extended Configuration of RX_AACK mode</a>), also the bit <a class="el" href="group__apiHalPHY212Const.html#gf6899ef98af446c018af6fa8d9f414dc">TRX_IRQ_AMI</a> will be set in the register <a class="el" href="group__apiHalPHY212Reg.html#g7dec4b1e3d3bfd3e9f6c243abc4f008e">RG_IRQ_STATUS</a>.<p>
<div align="center">
<img src="inline_mscgraph_52.png" alt="inline_mscgraph_52" border="0" usemap="#inline_mscgraph_52.map">
<map name="inline_mscgraph_52.map"><area href="grpIntroStates.html#stTrxActive" shape="rect" coords="427,26,473,39" alt="">
</map>
</div>
 <dl class="user" compact><dt><b>Code example</b></dt><dd><div class="fragment"><pre class="fragment">    <span class="comment">/* AT86RF212::[ACTIVE] */</span>
    <a class="code" href="group__apiHalFuncBasic.html#g63cd512542173c0a69f2ead0890defed" title="Write a value to a register.">trx_reg_write</a>(<a class="code" href="group__apiHalPHY212Reg.html#g905b648376932649f2af990f20a03df6">RG_IRQ_MASK</a>, mskirqs);
    <a class="code" href="group__apiHalFuncBasic.html#g4a22a30602ea72effde4450ce80a6480" title="Write a value to a subregister.">trx_bit_write</a>(<a class="code" href="group__apiHalPHY212Sreg.html#g0b612a879da54e0353cc43dbaf79de05">SR_IRQ_MASK_MODE</a>, mskmode);
</pre></div></dd></dl>
<h2><a class="anchor" name="secirq_polarity">
IRQ Polarity Configuration</a></h2>
The polarity of the pin <a class="el" href="grpIntroMCU.html#wirePinIrq">TRX_PIN_IRQ</a> is configured with the sub register <a class="el" href="group__apiHalPHY212Sreg.html#ga0f3a99f97243d3cb2071cb771f918be">SR_IRQ_POLARITY</a>. Before doing so, the content of the <a class="el" href="group__apiHalPHY212Reg.html#g905b648376932649f2af990f20a03df6">RG_IRQ_MASK</a> has to be saved, in order to restore it after changing the polarity.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>irqpol</em>&nbsp;</td><td>Polarity of the IRQ<br>
 {0} : IRQ is active high<br>
 {1} : IRQ is active low</td></tr>
  </table>
</dl>
<div align="center">
<img src="inline_mscgraph_53.png" alt="inline_mscgraph_53" border="0" usemap="#inline_mscgraph_53.map">
<map name="inline_mscgraph_53.map"><area href="grpIntroStates.html#stTrxOff" shape="rect" coords="430,26,470,39" alt="">
</map>
</div>
 <dl class="user" compact><dt><b>Code example</b></dt><dd><div class="fragment"><pre class="fragment">    <span class="comment">/* AT86RF212::TRX_OFF */</span>
    irqmsk = <a class="code" href="group__apiHalFuncBasic.html#gd31a9a2f63e52d485d975d59f7c1d5f4" title="Read the value from a register.">trx_reg_read</a>(<a class="code" href="group__apiHalPHY212Reg.html#g905b648376932649f2af990f20a03df6">RG_IRQ_MASK</a>);
    <a class="code" href="group__apiHalFuncBasic.html#g63cd512542173c0a69f2ead0890defed" title="Write a value to a register.">trx_reg_write</a>(<a class="code" href="group__apiHalPHY212Reg.html#g905b648376932649f2af990f20a03df6">RG_IRQ_MASK</a>, 0);
    dummy = <a class="code" href="group__apiHalFuncBasic.html#gd31a9a2f63e52d485d975d59f7c1d5f4" title="Read the value from a register.">trx_reg_read</a>(<a class="code" href="group__apiHalPHY212Reg.html#g7dec4b1e3d3bfd3e9f6c243abc4f008e">RG_IRQ_STATUS</a>);
    <a class="code" href="group__apiHalFuncBasic.html#g4a22a30602ea72effde4450ce80a6480" title="Write a value to a subregister.">trx_bit_write</a>(<a class="code" href="group__apiHalPHY212Sreg.html#ga0f3a99f97243d3cb2071cb771f918be">SR_IRQ_POLARITY</a>, irqpol);
    <a class="code" href="group__apiHalFuncBasic.html#g63cd512542173c0a69f2ead0890defed" title="Write a value to a register.">trx_reg_write</a>(<a class="code" href="group__apiHalPHY212Reg.html#g905b648376932649f2af990f20a03df6">RG_IRQ_MASK</a>, irqmsk);
</pre></div></dd></dl>
<h2><a class="anchor" name="secphy_irq">
IRQ Handling</a></h2>
If an interrupt event in the radio transceiver occurs, the <a class="el" href="grpIntroMCU.html#wirePinIrq">TRX_PIN_IRQ</a> is raised to active level. While processing this interrupt request, the MCU acknowledges the interrupt by reading the register <a class="el" href="group__apiHalPHY212Reg.html#g7dec4b1e3d3bfd3e9f6c243abc4f008e">RG_IRQ_STATUS</a>. The read operation also switches the signal on the <a class="el" href="grpIntroMCU.html#wirePinIrq">TRX_PIN_IRQ</a> back to inactive level and clears the register <a class="el" href="group__apiHalPHY212Reg.html#g7dec4b1e3d3bfd3e9f6c243abc4f008e">RG_IRQ_STATUS</a>.<p>
<dl compact><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>cause</em>&nbsp;</td><td>This return parameter contains a flag value, indicating the <a class="el" href="grpHandleIrq.html#knownirqs">interrupt cause</a>.</td></tr>
  </table>
</dl>
<dl class="note" compact><dt><b>Note:</b></dt><dd><br>
<small><b>&gt;&gt;</b></small>&nbsp; Depending on the actual interrupt latency time of the MCU, <b>more than one flag bit</b> can be set within one interrupt event. <br>
<small><b>&gt;&gt;</b></small>&nbsp; During the transition from <a class="el" href="grpIntroStates.html#stPOn">P_ON</a> (not contained in <a class="el" href="grpIntroStates.html#stTrxActive">[ACTIVE]</a>) to <a class="el" href="grpIntroStates.html#stTrxOff">TRX_OFF</a>, the <a class="el" href="grpIrqAwake.html">TRX_IRQ_AWAKE_END</a> occurs, as described in <a class="el" href="grpPhyReset.html#secpower_on_reset">POWER_ON_RESET</a>.</dd></dl>
<div align="center">
<img src="inline_mscgraph_54.png" alt="inline_mscgraph_54" border="0" usemap="#inline_mscgraph_54.map">
<map name="inline_mscgraph_54.map"><area href="grpIntroStates.html#stTrxActive" shape="rect" coords="427,26,473,39" alt="">
</map>
</div>
 <dl class="user" compact><dt><b>Code example</b></dt><dd><div class="fragment"><pre class="fragment">    <span class="comment">/* AT86RF212::[ACTIVE] */</span>
    <span class="comment">/* TRX_IRQ_[*] occurs here */</span>
    <span class="comment">/* MCU::ISR */</span>
    cause = <a class="code" href="group__apiHalFuncBasic.html#gd31a9a2f63e52d485d975d59f7c1d5f4" title="Read the value from a register.">trx_reg_read</a>(<a class="code" href="group__apiHalPHY212Reg.html#g7dec4b1e3d3bfd3e9f6c243abc4f008e">RG_IRQ_STATUS</a>);
    proc_irq(cause);
</pre></div> </dd></dl>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Aug 17 13:35:00 2009 for SWPM AT86RF212 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
