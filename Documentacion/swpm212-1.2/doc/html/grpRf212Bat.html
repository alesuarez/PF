<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>SWPM AT86RF212: Battery Monitor</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="main.html">AT86RF212 Programming</a>&nbsp;&raquo&nbsp;<a class="el" href="pgSwpmAT86RF212.html">Software Programming Model</a>&nbsp;&raquo&nbsp;<a class="el" href="grpCfg.html">Radio Transceiver Configuration</a>
  </div>
</div>
<div class="contents">
<h1><a class="anchor" name="grpRf212Bat">Battery Monitor </a></h1>This section describes, how the battery monitor is configured and used.<p>
<b>Use Cases:</b><ul>
<li><a class="el" href="grpRf212Bat.html#secphy_set_batmon">PHY_SET_BATMON</a></li><li><a class="el" href="grpRf212Bat.html#secphy_batmon_interrupt">PHY_SIGNAL_BAT_LOW</a></li><li><a class="el" href="grpRf212Bat.html#secphy_get_batmon">PHY_GET_BATMON_STATUS</a></li></ul>
<p>
<hr>
<h2><a class="anchor" name="secphy_set_batmon">
PHY_SET_BATMON</a></h2>
The battery monitor is configured with two parameters <em>vrange</em> and <em>vthres</em>. The voltage level <em>vbatlow</em> defines, at which level the battery monitor detects and signals a low voltage condition.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>vrange</em>&nbsp;</td><td>This parameter can be {0,1} and adjusts the range of the parameter <em>vthres</em>. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>vthres</em>&nbsp;</td><td>This parameter is in the range of {0,...,15} and adjusts the threshold voltage.</td></tr>
  </table>
</dl>
The trigger voltage <em>vbatlow</em> depends on the values of <em>vrange</em> and <em>vthres:</em> <ul>
<li><em>vrange</em> = 0 : <em>vbatlow/V</em> = 1.700 + (0.050 * <em>vthres</em>)</li><li><em>vrange</em> = 1 : <em>vbatlow/V</em> = 2.550 + (0.075 * <em>vthres</em>)</li></ul>
<p>
<div align="center">
<img src="inline_mscgraph_24.png" alt="inline_mscgraph_24" border="0" usemap="#inline_mscgraph_24.map">
<map name="inline_mscgraph_24.map"><area href="grpIntroStates.html#stTrxActive" shape="rect" coords="427,26,473,39" alt="">
</map>
</div>
 <dl class="user" compact><dt><b>Code example</b></dt><dd><div class="fragment"><pre class="fragment">    <span class="comment">/* AT86RF212::[ACTIVE] */</span>
    <a class="code" href="group__apiHalFuncBasic.html#g4a22a30602ea72effde4450ce80a6480" title="Write a value to a subregister.">trx_bit_write</a>(<a class="code" href="group__apiHalPHY212Sreg.html#gaade16ed1ba624efbf6a71cb66af9d0f">SR_BATMON_HR</a>, vrange);
    <a class="code" href="group__apiHalFuncBasic.html#g4a22a30602ea72effde4450ce80a6480" title="Write a value to a subregister.">trx_bit_write</a>(<a class="code" href="group__apiHalPHY212Sreg.html#gf4d8678ff08d67835ed9fde2e063e524">SR_BATMON_VTH</a>, vthres);
</pre></div></dd></dl>
<h2><a class="anchor" name="secphy_batmon_interrupt">
PHY_SIGNAL_BAT_LOW</a></h2>
If the supply voltage drops below the configured threshold voltage <code>vbatlow</code>, the <a class="el" href="group__apiHalPHY212Const.html#g5b062cb127d62117b7c36881e79fc9e3">TRX_IRQ_BAT_LOW</a> interrupt is generated. It is recommended to mask this interrupt after its first occurrence, because otherwise an IRQ flood can happen. This interrupt should not be reenabled before the voltage threshold is reprogrammed or the power supply has stabilized.<p>
Due to the variable power consumption of the radio transceiver in different states, it may happen, that after an <a class="el" href="group__apiHalPHY212Const.html#g5b062cb127d62117b7c36881e79fc9e3">TRX_IRQ_BAT_LOW</a> interrupt the sequence <a class="el" href="grpRf212Bat.html#secphy_get_batmon">PHY_GET_BATMON_STATUS</a> returns with OK. Nevertheless, the IRQ should be interpreted as an early indicator for low battery capacity. The battery capacity should be monitored more carefully from this point in time.<p>
<div align="center">
<img src="inline_mscgraph_25.png" alt="inline_mscgraph_25" border="0" usemap="#inline_mscgraph_25.map">
<map name="inline_mscgraph_25.map"><area href="grpIntroStates.html#stTrxActive" shape="rect" coords="427,26,473,39" alt="">
</map>
</div>
 <dl class="user" compact><dt><b>Code example</b></dt><dd><div class="fragment"><pre class="fragment">    <span class="comment">/* AT86RF212::[ACTIVE] */</span>
    <span class="comment">/* TRX_IRQ_BAT_LOW occurs here */</span>
    msk = <a class="code" href="group__apiHalFuncBasic.html#gd31a9a2f63e52d485d975d59f7c1d5f4" title="Read the value from a register.">trx_reg_read</a>(<a class="code" href="group__apiHalPHY212Reg.html#g905b648376932649f2af990f20a03df6">RG_IRQ_MASK</a>);
    msk &amp;=0x7f;
    <a class="code" href="group__apiHalFuncBasic.html#g63cd512542173c0a69f2ead0890defed" title="Write a value to a register.">trx_reg_write</a>(<a class="code" href="group__apiHalPHY212Reg.html#g905b648376932649f2af990f20a03df6">RG_IRQ_MASK</a>, msk);
</pre></div></dd></dl>
<h2><a class="anchor" name="secphy_get_batmon">
PHY_GET_BATMON_STATUS</a></h2>
<div align="center">
<img src="inline_mscgraph_26.png" alt="inline_mscgraph_26" border="0" usemap="#inline_mscgraph_26.map">
<map name="inline_mscgraph_26.map"><area href="grpIntroStates.html#stTrxActive" shape="rect" coords="427,26,473,39" alt="">
</map>
</div>
 <dl class="user" compact><dt><b>Code example</b></dt><dd><div class="fragment"><pre class="fragment">    <span class="comment">/* AT86RF212::[ACTIVE] */</span>
    batstat = <a class="code" href="group__apiHalFuncBasic.html#ge7ea3d090b5d26b73a5c62e2e61e0231" title="Read a value from a subregister.">trx_bit_read</a>(<a class="code" href="group__apiHalPHY212Sreg.html#gcff72bdcbf66f9ef80b51797328f04b4">SR_BATMON_OK</a>);
</pre></div> </dd></dl>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Aug 17 13:34:59 2009 for SWPM AT86RF212 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
