<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>SWPM AT86RF212: Frame Buffer Protection (Static/Dynamic)</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="main.html">AT86RF212 Programming</a>&nbsp;&raquo&nbsp;<a class="el" href="pgSwpmAT86RF212.html">Software Programming Model</a>&nbsp;&raquo&nbsp;<a class="el" href="grpMisc.html">Extended Features</a>
  </div>
</div>
<div class="contents">
<h1><a class="anchor" name="grpFProt">Frame Buffer Protection (Static/Dynamic) </a></h1>There are different ways to safely keep the PSDU in the frame buffer without the risk of being overwritten by consecutively received frames.<p>
<dl class="user" compact><dt><b>Static Frame Buffer Protection</b></dt><dd></dd></dl>
<ul>
<li><a class="el" href="grpFProt.html#secprotect_static">PREAMBLE_DETECTOR_DISABLE</a></li><li><a class="el" href="grpFProt.html#secprotect_static_pllon">SWITCHING_TO_PLL_ON</a></li></ul>
<p>
<a class="anchor" name="secDynamicProt"></a> <dl class="user" compact><dt><b>Dynamic Frame Buffer Protection</b></dt><dd></dd></dl>
<ul>
<li><a class="el" href="grpFProt.html#secset_protect_dynamic">SET_PROTECT_DYNAMIC</a></li><li><a class="el" href="grpFProt.html#secget_protect_dynamic">GET_PROTECT_DYNAMIC</a></li></ul>
<p>
<a class="anchor" name="parm_safe_mode"></a> <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>safe_mode</em>&nbsp;</td><td>enable {1}/disable {0} dynamic frame buffer protection.</td></tr>
  </table>
</dl>
<h2><a class="anchor" name="secprotect_static">
PREAMBLE_DETECTOR_DISABLE</a></h2>
One way to protect the frame buffer against overwriting is to disable the preamble detector. This can be achieved by writing value 1 to sub register <a class="el" href="group__apiHalPHY212Sreg.html#g59bf6874e9e337c3fb963cad4309ecd0">SR_RX_PDT_DIS</a>, e.g. right after the occurrence of one of the interrupts <a class="el" href="group__apiHalPHY212Const.html#gab5ff5ca963c7556f4f1e0e37f045604">TRX_IRQ_RX_START</a> (shown in the use case below) or <a class="el" href="group__apiHalPHY212Const.html#gf6899ef98af446c018af6fa8d9f414dc">TRX_IRQ_AMI</a>. When the MCU is ready to process more frames, the preamble detector gets enabled by writing the value 0 to the sub register <a class="el" href="group__apiHalPHY212Sreg.html#g59bf6874e9e337c3fb963cad4309ecd0">SR_RX_PDT_DIS</a>.<p>
<dl class="note" compact><dt><b>Note:</b></dt><dd>Disabling the preamble detector can also be applied for monitoring the RF channel parameters (<a class="el" href="grpPhyRSSIED.html">ED, RSSI</a>, <a class="el" href="grpPhyCCA.html">CCA</a>) in order to avoid the reception of frames during the measurement.</dd></dl>
<div align="center">
<img src="inline_mscgraph_109.png" alt="inline_mscgraph_109" border="0" usemap="#inline_mscgraph_109.map">
<map name="inline_mscgraph_109.map"><area href="grpIntroStates.html#stRxActive" shape="rect" coords="418,26,482,39" alt="">
<area href="pgConst.html#tPSDU" shape="rect" coords="160,144,195,157" alt="">
<area href="grpIntroStates.html#stRxActive" shape="rect" coords="418,276,482,289" alt="">
</map>
</div>
 <dl class="user" compact><dt><b>Code example</b></dt><dd><div class="fragment"><pre class="fragment">    <span class="comment">/* AT86RF212::[RX_ACTIVE] */</span>
    <span class="comment">/* TRX_IRQ_RX_START occurs here */</span>
    <a class="code" href="group__apiHalFuncBasic.html#g4a22a30602ea72effde4450ce80a6480" title="Write a value to a subregister.">trx_bit_write</a>(<a class="code" href="group__apiHalPHY212Sreg.html#g59bf6874e9e337c3fb963cad4309ecd0">SR_RX_PDT_DIS</a>, 1);
    delay(tPSDU);
    frame = <a class="code" href="group__apiHalFuncBasic.html#g88ff4f45a0c4c7435d686150cc7fb4c2" title="Read a frame from the radio transceiver.">trx_frame_read</a>();
    <a class="code" href="group__apiHalFuncBasic.html#g4a22a30602ea72effde4450ce80a6480" title="Write a value to a subregister.">trx_bit_write</a>(<a class="code" href="group__apiHalPHY212Sreg.html#g59bf6874e9e337c3fb963cad4309ecd0">SR_RX_PDT_DIS</a>, 0);
    <span class="comment">/* AT86RF212::[RX_ACTIVE] */</span>
</pre></div></dd></dl>
<h2><a class="anchor" name="secprotect_static_pllon">
SWITCHING_TO_PLL_ON</a></h2>
The frame buffer can also be protected against overwriting by setting the radio transceiver into state <a class="el" href="grpIntroStates.html#stPllOn">PLL_ON</a>. This can be achieved by writing value <a class="el" href="group__apiHalPHY212Const.html#g86eb3f35dbb0833379e005d0a934ed95">CMD_PLL_ON</a> to sub register <a class="el" href="group__apiHalPHY212Sreg.html#g8d912618842812f37fc46356eff73c93">SR_TRX_CMD</a>, e.g. right after the occurrence of one of the interrupts <a class="el" href="group__apiHalPHY212Const.html#gab5ff5ca963c7556f4f1e0e37f045604">TRX_IRQ_RX_START</a> (shown in the use case below) or <a class="el" href="group__apiHalPHY212Const.html#gf6899ef98af446c018af6fa8d9f414dc">TRX_IRQ_AMI</a>. When the MCU is ready to process more frames, the radio transceiver can be set back to one of the receive states <a class="el" href="grpIntroStates.html#stRxOn">RX_ON</a> or <a class="el" href="grpIntroStates.html#stRxAackOn">RX_AACK_ON</a>.<p>
<div align="center">
<img src="inline_mscgraph_110.png" alt="inline_mscgraph_110" border="0" usemap="#inline_mscgraph_110.map">
<map name="inline_mscgraph_110.map"><area href="grpIntroStates.html#stTrxRXBusy" shape="rect" coords="424,26,476,39" alt="">
<area href="pgConst.html#tPSDU" shape="rect" coords="160,144,195,157" alt="">
<area href="grpIntroStates.html#stPllOn" shape="rect" coords="433,226,467,239" alt="">
<area href="grpIntroStates.html#stRxOn" shape="rect" coords="436,351,464,364" alt="">
</map>
</div>
 <dl class="user" compact><dt><b>Code example</b></dt><dd><div class="fragment"><pre class="fragment">    <span class="comment">/* AT86RF212::[RX_BUSY] */</span>
    <span class="comment">/* TRX_IRQ_RX_START occurs here */</span>
    <a class="code" href="group__apiHalFuncBasic.html#g4a22a30602ea72effde4450ce80a6480" title="Write a value to a subregister.">trx_bit_write</a>(<a class="code" href="group__apiHalPHY212Sreg.html#g8d912618842812f37fc46356eff73c93">SR_TRX_CMD</a>, <a class="code" href="group__apiHalPHY212Const.html#g86eb3f35dbb0833379e005d0a934ed95">CMD_PLL_ON</a>);
    delay(tPSDU);
    <span class="comment">/* AT86RF212::PLL_ON */</span>
    frame = <a class="code" href="group__apiHalFuncBasic.html#g88ff4f45a0c4c7435d686150cc7fb4c2" title="Read a frame from the radio transceiver.">trx_frame_read</a>();
    <a class="code" href="group__apiHalFuncBasic.html#g4a22a30602ea72effde4450ce80a6480" title="Write a value to a subregister.">trx_bit_write</a>(<a class="code" href="group__apiHalPHY212Sreg.html#g8d912618842812f37fc46356eff73c93">SR_TRX_CMD</a>, <a class="code" href="group__apiHalPHY212Const.html#g5e4387f9db7294eb0e03a97505aac7c0">CMD_RX_ON</a>);
    trxstat = <a class="code" href="group__apiHalFuncBasic.html#ge7ea3d090b5d26b73a5c62e2e61e0231" title="Read a value from a subregister.">trx_bit_read</a>(<a class="code" href="group__apiHalPHY212Sreg.html#gbb9dcc6f85b1154d76645b5de64d4835">SR_TRX_STATUS</a>);
    ASSERT(trxstat==<a class="code" href="group__apiHalPHY212Const.html#g359db88bcffa6b39bdb64ec00ec3a1ae">RX_ON</a>);
    <span class="comment">/* AT86RF212::RX_ON */</span>
</pre></div></dd></dl>
<h2><a class="anchor" name="secset_protect_dynamic">
SET_PROTECT_DYNAMIC</a></h2>
The dynamic frame buffer protection prevents the overwriting of valid frames until the frame read functions <a class="el" href="group__apiHalFuncBasic.html#g88ff4f45a0c4c7435d686150cc7fb4c2">trx_frame_read()</a> or by <a class="el" href="group__apiHalFuncBasic.html#gee1a17975e51ef9df001ff17be1cf6f5">trx_frame_read_blm()</a> have comleted.<p>
A frame is classified as valid in the Basic Operating Mode (RX_ON) if it has a valid FCS. In the Extended Operating Mode (RX_AACK_ON) a frame is valid if it matches the address filter and has a valid FCS.<p>
The protection is enabled by writing <a class="el" href="grpFProt.html#parm_safe_mode">safe_mode</a>=1 to <a class="el" href="group__apiHalPHY212Sreg.html#g6d2d3f16272406c75ec8f7c2602ec063">SR_RX_SAFE_MODE</a> and it holds until the end of a frame buffer read access, indicated by /SEL=HIGH.<p>
<div align="center">
<img src="inline_mscgraph_111.png" alt="inline_mscgraph_111" border="0" usemap="#inline_mscgraph_111.map">
<map name="inline_mscgraph_111.map"><area href="grpIntroStates.html#stTrxConfig" shape="rect" coords="427,26,473,39" alt="">
</map>
</div>
 <dl class="user" compact><dt><b>Code example</b></dt><dd><div class="fragment"><pre class="fragment">    <span class="comment">/* AT86RF212::[CONFIG] */</span>
    <a class="code" href="group__apiHalFuncBasic.html#g4a22a30602ea72effde4450ce80a6480" title="Write a value to a subregister.">trx_bit_write</a>(<a class="code" href="group__apiHalPHY212Sreg.html#g6d2d3f16272406c75ec8f7c2602ec063">SR_RX_SAFE_MODE</a>, safe_mode);
</pre></div></dd></dl>
<h2><a class="anchor" name="secget_protect_dynamic">
GET_PROTECT_DYNAMIC</a></h2>
Reading the value <a class="el" href="grpFProt.html#parm_safe_mode">safe_mode</a> of <a class="el" href="group__apiHalPHY212Sreg.html#g6d2d3f16272406c75ec8f7c2602ec063">SR_RX_SAFE_MODE</a> indicates whether the dynamic frame protection is enabled or not.<p>
<div align="center">
<img src="inline_mscgraph_112.png" alt="inline_mscgraph_112" border="0" usemap="#inline_mscgraph_112.map">
<map name="inline_mscgraph_112.map"><area href="grpIntroStates.html#stTrxActive" shape="rect" coords="427,26,473,39" alt="">
</map>
</div>
 <dl class="user" compact><dt><b>Code example</b></dt><dd><div class="fragment"><pre class="fragment">    <span class="comment">/* AT86RF212::[ACTIVE] */</span>
    safe_mode = <a class="code" href="group__apiHalFuncBasic.html#ge7ea3d090b5d26b73a5c62e2e61e0231" title="Read a value from a subregister.">trx_bit_read</a>(<a class="code" href="group__apiHalPHY212Sreg.html#g6d2d3f16272406c75ec8f7c2602ec063">SR_RX_SAFE_MODE</a>);
</pre></div> </dd></dl>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Aug 17 13:35:02 2009 for SWPM AT86RF212 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
