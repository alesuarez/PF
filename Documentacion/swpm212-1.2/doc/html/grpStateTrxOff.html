<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>SWPM AT86RF212: Transitions to State TRX_OFF</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="main.html">AT86RF212 Programming</a>&nbsp;&raquo&nbsp;<a class="el" href="pgSwpmAT86RF212.html">Software Programming Model</a>&nbsp;&raquo&nbsp;<a class="el" href="grpState.html">State Changes</a>
  </div>
</div>
<div class="contents">
<h1><a class="anchor" name="grpStateTrxOff">Transitions to State TRX_OFF </a></h1>This section describes how the state <a class="el" href="grpIntroStates.html#stTrxOff">TRX_OFF</a> is entered. There are two ways to get into this state.<p>
<ol type=1>
<li>Writing <a class="el" href="group__apiHalPHY212Const.html#g2f2b663a799906d316824bba67572502">CMD_TRX_OFF</a> to sub register <a class="el" href="group__apiHalPHY212Sreg.html#g8d912618842812f37fc46356eff73c93">SR_TRX_CMD</a> requests a state change towards <a class="el" href="grpIntroStates.html#stTrxOff">TRX_OFF</a>. If the radio transceiver is in one of the <a class="el" href="grpIntroStates.html#stTrxBusy">[BUSY]</a> states, the ongoing transaction will be finished before the state change occurs. Otherwise, the state transition is executed immediately. The following transitions are defined:<ul>
<li><a class="el" href="grpStateTrxOff.html#secplme_set_trx_state_trxoff_at_pll_active">PHY_STATE_[PLL_ACTIVE]__TRX_OFF</a></li><li><a class="el" href="grpStateTrxOff.html#secplme_set_trx_state_trxoff_at_busynotrxaack">PHY_STATE_[BUSY]__TRX_OFF</a></li><li><a class="el" href="grpStateTrxOff.html#secplme_set_trx_state_trxoff_at_busyrxaack">PHY_STATE_BUSY_RX_AACK__TRX_OFF</a></li></ul>
</li><li>Writing <a class="el" href="group__apiHalPHY212Const.html#g8ecc63755abb125691b00426cba7fe41">CMD_FORCE_TRX_OFF</a> to sub register <a class="el" href="group__apiHalPHY212Sreg.html#g8d912618842812f37fc46356eff73c93">SR_TRX_CMD</a> causes an immediate transition. In this case, any ongoing transaction in one of the <a class="el" href="grpIntroStates.html#stTrxBusy">[BUSY]</a> states is canceled and the state change is done.<ul>
<li><a class="el" href="grpStateTrxOff.html#secplme_force_trx_off_at_pll_active">PHY_FORCE_[ACTIVE]__TRX_OFF</a></li></ul>
</li></ol>
<p>
<hr>
<h2><a class="anchor" name="secplme_set_trx_state_trxoff_at_pll_active">
PHY_STATE_[PLL_ACTIVE]__TRX_OFF</a></h2>
<div align="center">
<img src="inline_mscgraph_34.png" alt="inline_mscgraph_34" border="0" usemap="#inline_mscgraph_34.map">
<map name="inline_mscgraph_34.map"><area href="grpIntroStates.html#stPllActive" shape="rect" coords="415,26,485,39" alt="">
<area href="pgConst.html#tTRSw" shape="rect" coords="160,69,195,82" alt="">
<area href="grpIntroStates.html#stTrxOff" shape="rect" coords="430,126,470,139" alt="">
</map>
</div>
 <dl class="user" compact><dt><b>Code example</b></dt><dd><div class="fragment"><pre class="fragment">    <span class="comment">/* AT86RF212::[PLL_ACTIVE] */</span>
    <a class="code" href="group__apiHalFuncBasic.html#g4a22a30602ea72effde4450ce80a6480" title="Write a value to a subregister.">trx_bit_write</a>(<a class="code" href="group__apiHalPHY212Sreg.html#g8d912618842812f37fc46356eff73c93">SR_TRX_CMD</a>, <a class="code" href="group__apiHalPHY212Const.html#g2f2b663a799906d316824bba67572502">CMD_TRX_OFF</a>);
    delay(tTRSw);
    <span class="comment">/* AT86RF212::TRX_OFF */</span>
    trxstat = <a class="code" href="group__apiHalFuncBasic.html#ge7ea3d090b5d26b73a5c62e2e61e0231" title="Read a value from a subregister.">trx_bit_read</a>(<a class="code" href="group__apiHalPHY212Sreg.html#gbb9dcc6f85b1154d76645b5de64d4835">SR_TRX_STATUS</a>);
    ASSERT(trxstat==<a class="code" href="group__apiHalPHY212Const.html#gd9aff3d987888b9d1bcb9fc12d2c996e">TRX_OFF</a>);
</pre></div></dd></dl>
<h2><a class="anchor" name="secplme_set_trx_state_trxoff_at_busynotrxaack">
PHY_STATE_[BUSY]__TRX_OFF</a></h2>
If the command <a class="el" href="group__apiHalPHY212Const.html#g2f2b663a799906d316824bba67572502">CMD_TRX_OFF</a> is written to the sub register <a class="el" href="group__apiHalPHY212Sreg.html#g8d912618842812f37fc46356eff73c93">SR_TRX_CMD</a> and the radio transceiver is in one of the <a class="el" href="grpIntroStates.html#stTrxBusy">[BUSY]</a> states, the ongoing transmit or receive transaction is completed and the state change to <a class="el" href="grpIntroStates.html#stTrxOff">TRX_OFF</a> occurs with the <a class="el" href="group__apiHalPHY212Const.html#ge34c1f5817526945d96c7cda6689f342">TRX_IRQ_TRX_END</a> interrupt.<p>
<dl class="note" compact><dt><b>Note:</b></dt><dd><br>
<small><b>&gt;&gt;</b></small>&nbsp; It is possible to cancel any ongoing transaction and force an immediate state change by using <a class="el" href="group__apiHalPHY212Const.html#g8ecc63755abb125691b00426cba7fe41">CMD_FORCE_TRX_OFF</a> (see <a class="el" href="grpStateTrxOff.html#secplme_force_trx_off_at_pll_active">PHY_FORCE_[ACTIVE]__TRX_OFF</a>). This might be especially useful in <a class="el" href="grpIntroStates.html#stTxAretBusy">BUSY_TX_ARET</a>, when long backoff times and many CSMA/frame retransmissions are configured. <br>
<small><b>&gt;&gt;</b></small>&nbsp; This use case is not valid for state <a class="el" href="grpIntroStates.html#stRxAackBusy">BUSY_RX_AACK</a>, because a <a class="el" href="group__apiHalPHY212Const.html#ge34c1f5817526945d96c7cda6689f342">TRX_IRQ_TRX_END</a> interrupt does not necessary occur in this state. For handling of this state refer to <a class="el" href="grpStateTrxOff.html#secplme_set_trx_state_trxoff_at_busyrxaack">PHY_STATE_BUSY_RX_AACK__TRX_OFF</a>.</dd></dl>
<div align="center">
<img src="inline_mscgraph_35.png" alt="inline_mscgraph_35" border="0" usemap="#inline_mscgraph_35.map">
<map name="inline_mscgraph_35.map"><area href="grpIntroStates.html#stTrxBusy" shape="rect" coords="433,26,467,39" alt="">
<area href="grpIntroStates.html#stTrxOff" shape="rect" coords="430,126,470,139" alt="">
</map>
</div>
 <dl class="user" compact><dt><b>Code example</b></dt><dd><div class="fragment"><pre class="fragment">    <span class="comment">/* AT86RF212::[BUSY] */</span>
    <a class="code" href="group__apiHalFuncBasic.html#g4a22a30602ea72effde4450ce80a6480" title="Write a value to a subregister.">trx_bit_write</a>(<a class="code" href="group__apiHalPHY212Sreg.html#g8d912618842812f37fc46356eff73c93">SR_TRX_CMD</a>, <a class="code" href="group__apiHalPHY212Const.html#g2f2b663a799906d316824bba67572502">CMD_TRX_OFF</a>);
    <span class="comment">/* TRX_IRQ_TRX_END occurs here */</span>
    <span class="comment">/* AT86RF212::TRX_OFF */</span>
    trxstat = <a class="code" href="group__apiHalFuncBasic.html#ge7ea3d090b5d26b73a5c62e2e61e0231" title="Read a value from a subregister.">trx_bit_read</a>(<a class="code" href="group__apiHalPHY212Sreg.html#gbb9dcc6f85b1154d76645b5de64d4835">SR_TRX_STATUS</a>);
    ASSERT(trxstat==<a class="code" href="group__apiHalPHY212Const.html#gd9aff3d987888b9d1bcb9fc12d2c996e">TRX_OFF</a>);
</pre></div></dd></dl>
<h2><a class="anchor" name="secplme_set_trx_state_trxoff_at_busyrxaack">
PHY_STATE_BUSY_RX_AACK__TRX_OFF</a></h2>
If the radio transceiver is in state <a class="el" href="grpIntroStates.html#stRxAackBusy">BUSY_RX_AACK</a>, an <a class="el" href="group__apiHalPHY212Const.html#ge34c1f5817526945d96c7cda6689f342">TRX_IRQ_TRX_END</a> occurs only, if the incoming frame matches the address filter and if the FCS is correct. If the acknowledgment request bit is set in the frame control field of the frame header and a <a class="el" href="group__apiHalPHY212Const.html#ge34c1f5817526945d96c7cda6689f342">TRX_IRQ_TRX_END</a> interrupt occurs, an automatically generated acknowledgement will be transmitted. Thus, the transceiver will stay in <a class="el" href="grpIntroStates.html#stRxAackBusy">BUSY_RX_AACK</a> for time <a class="el" href="pgConst.html#tPAck">tPAck</a> after <a class="el" href="group__apiHalPHY212Const.html#ge34c1f5817526945d96c7cda6689f342">TRX_IRQ_TRX_END</a>. Otherwise, it will return to <a class="el" href="grpIntroStates.html#stTrxOff">TRX_OFF</a> at latest after <a class="el" href="pgConst.html#tFrame">tFrame</a>.<p>
<dl class="note" compact><dt><b>Note:</b></dt><dd><br>
<small><b>&gt;&gt;</b></small>&nbsp; It is possible to read the acknowledgment request subfield of a frame after <a class="el" href="group__apiHalPHY212Const.html#ge34c1f5817526945d96c7cda6689f342">TRX_IRQ_TRX_END</a>. If this bit is not set, the radio transceiver will be in state <a class="el" href="grpIntroStates.html#stTrxOff">TRX_OFF</a> immediately after the interrupt. <br>
<small><b>&gt;&gt;</b></small>&nbsp; To avoid long timeouts, it is possible to use command <a class="el" href="group__apiHalPHY212Const.html#g8ecc63755abb125691b00426cba7fe41">CMD_FORCE_TRX_OFF</a> to initiate an immediate state change (see <a class="el" href="grpStateTrxOff.html#secplme_force_trx_off_at_pll_active">PHY_FORCE_[ACTIVE]__TRX_OFF</a>). <br>
<small><b>&gt;&gt;</b></small>&nbsp; The use case shown here is only valid for a node operating in unslotted mode. If <a class="el" href="group__apiHalPHY212Const.html#g2f2b663a799906d316824bba67572502">CMD_TRX_OFF</a> is written to a node operating in slotted mode the procedure shown in <a class="el" href="grpRf212AutoRx.html#secphy_data_indication_autorx_slotted">PHY_DATA_INDICATION_RX_AACK_SLOTTED</a> is finished and the node will be in <a class="el" href="grpIntroStates.html#stTrxOff">TRX_OFF</a> afterwards.</dd></dl>
<div align="center">
<img src="inline_mscgraph_36.png" alt="inline_mscgraph_36" border="0" usemap="#inline_mscgraph_36.map">
<map name="inline_mscgraph_36.map"><area href="grpIntroStates.html#stRxAackBusy" shape="rect" coords="415,26,485,39" alt="">
<area href="pgConst.html#tFrame" shape="rect" coords="160,69,201,82" alt="">
<area href="pgConst.html#tPAck" shape="rect" coords="160,144,195,157" alt="">
<area href="grpIntroStates.html#stTrxOff" shape="rect" coords="430,226,470,239" alt="">
</map>
</div>
 <dl class="user" compact><dt><b>Code example</b></dt><dd><div class="fragment"><pre class="fragment">    <span class="comment">/* AT86RF212::BUSY_RX_AACK */</span>
    <a class="code" href="group__apiHalFuncBasic.html#g4a22a30602ea72effde4450ce80a6480" title="Write a value to a subregister.">trx_bit_write</a>(<a class="code" href="group__apiHalPHY212Sreg.html#g8d912618842812f37fc46356eff73c93">SR_TRX_CMD</a>, <a class="code" href="group__apiHalPHY212Const.html#gd9aff3d987888b9d1bcb9fc12d2c996e">TRX_OFF</a>);
    delay(tFrame);
    <span class="comment">/* AT86RF212::TRX_OFF */</span>
    trxstat = <a class="code" href="group__apiHalFuncBasic.html#ge7ea3d090b5d26b73a5c62e2e61e0231" title="Read a value from a subregister.">trx_bit_read</a>(<a class="code" href="group__apiHalPHY212Sreg.html#gbb9dcc6f85b1154d76645b5de64d4835">SR_TRX_STATUS</a>);
    ASSERT(trxstat==<a class="code" href="group__apiHalPHY212Const.html#gd9aff3d987888b9d1bcb9fc12d2c996e">TRX_OFF</a>);
</pre></div></dd></dl>
<h2><a class="anchor" name="secplme_force_trx_off_at_pll_active">
PHY_FORCE_[ACTIVE]__TRX_OFF</a></h2>
Writing <a class="el" href="group__apiHalPHY212Const.html#g8ecc63755abb125691b00426cba7fe41">CMD_FORCE_TRX_OFF</a> to sub register <a class="el" href="group__apiHalPHY212Sreg.html#g8d912618842812f37fc46356eff73c93">SR_TRX_CMD</a> in any of the <a class="el" href="grpIntroStates.html#stTrxActive">[ACTIVE]</a> states cancels any ongoing transmit or receive transcation and switches the radio transceiver within <a class="el" href="pgConst.html#tTR12">tTR12</a> to state <a class="el" href="grpIntroStates.html#stTrxOff">TRX_OFF</a>.<p>
In order to ensure that the radio transceiver is not in one of the *_NOCLK states, the pin <a class="el" href="grpIntroMCU.html#wirePinSleepTr">TRX_PIN_SLP_TR</a> is set to LOW before <a class="el" href="group__apiHalPHY212Const.html#g8ecc63755abb125691b00426cba7fe41">CMD_FORCE_TRX_OFF</a> is written.<p>
<div align="center">
<img src="inline_mscgraph_37.png" alt="inline_mscgraph_37" border="0" usemap="#inline_mscgraph_37.map">
<map name="inline_mscgraph_37.map"><area href="grpIntroStates.html#stTrxActive" shape="rect" coords="427,26,473,39" alt="">
<area href="pgConst.html#tTR12" shape="rect" coords="160,94,195,107" alt="">
<area href="grpIntroStates.html#stTrxOff" shape="rect" coords="430,151,470,164" alt="">
</map>
</div>
 <dl class="user" compact><dt><b>Code example</b></dt><dd><div class="fragment"><pre class="fragment">    <span class="comment">/* AT86RF212::[ACTIVE] */</span>
    <a class="code" href="group__apiHalFuncBasic.html#g7ffbe4411fb6d28f884fd3da4c206893" title="Set the level of the SLP_TR pin.">trx_pinset_slptr</a>(0);
    <a class="code" href="group__apiHalFuncBasic.html#g4a22a30602ea72effde4450ce80a6480" title="Write a value to a subregister.">trx_bit_write</a>(<a class="code" href="group__apiHalPHY212Sreg.html#g8d912618842812f37fc46356eff73c93">SR_TRX_CMD</a>, <a class="code" href="group__apiHalPHY212Const.html#g8ecc63755abb125691b00426cba7fe41">CMD_FORCE_TRX_OFF</a>);
    delay(tTR12);
    <span class="comment">/* AT86RF212::TRX_OFF */</span>
    trxstat = <a class="code" href="group__apiHalFuncBasic.html#ge7ea3d090b5d26b73a5c62e2e61e0231" title="Read a value from a subregister.">trx_bit_read</a>(<a class="code" href="group__apiHalPHY212Sreg.html#gbb9dcc6f85b1154d76645b5de64d4835">SR_TRX_STATUS</a>);
    ASSERT(trxstat==<a class="code" href="group__apiHalPHY212Const.html#gd9aff3d987888b9d1bcb9fc12d2c996e">TRX_OFF</a>);
</pre></div> </dd></dl>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Aug 17 13:34:59 2009 for SWPM AT86RF212 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
